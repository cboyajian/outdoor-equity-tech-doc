<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 8 User Documentation | Outdoor Equity App Technical Documentation</title>
  <meta name="description" content="Section 8 User Documentation | Outdoor Equity App Technical Documentation" />
  <meta name="generator" content="bookdown 0.23 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 8 User Documentation | Outdoor Equity App Technical Documentation" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="cboyajian/outdoor-equity-tech-doc" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 8 User Documentation | Outdoor Equity App Technical Documentation" />
  
  
  

<meta name="author" content="Clarissa Boyajian and Halina Do-Linh" />


<meta name="date" content="2022-06-03" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="summary-of-testing.html"/>
<link rel="next" href="additional-challenges.html"/>
<script src="libs/header-attrs-2.10.6/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Outdoor Equity App</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> About</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#abstract"><i class="fa fa-check"></i><b>1.1</b> Abstract</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#about-the-authors"><i class="fa fa-check"></i><b>1.2</b> About the Authors</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#helpful-links-and-resources"><i class="fa fa-check"></i><b>1.3</b> Helpful Links and Resources</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="executive-summary.html"><a href="executive-summary.html"><i class="fa fa-check"></i><b>2</b> Executive Summary</a></li>
<li class="chapter" data-level="3" data-path="problem-statement.html"><a href="problem-statement.html"><i class="fa fa-check"></i><b>3</b> Problem Statement</a>
<ul>
<li class="chapter" data-level="3.1" data-path="problem-statement.html"><a href="problem-statement.html#background"><i class="fa fa-check"></i><b>3.1</b> Background</a></li>
<li class="chapter" data-level="3.2" data-path="problem-statement.html"><a href="problem-statement.html#significance"><i class="fa fa-check"></i><b>3.2</b> Significance</a></li>
<li class="chapter" data-level="3.3" data-path="problem-statement.html"><a href="problem-statement.html#figures"><i class="fa fa-check"></i><b>3.3</b> Figures</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="specific-objectives.html"><a href="specific-objectives.html"><i class="fa fa-check"></i><b>4</b> Specific Objectives</a></li>
<li class="chapter" data-level="5" data-path="summary-of-solution-design.html"><a href="summary-of-solution-design.html"><i class="fa fa-check"></i><b>5</b> Summary of Solution Design</a>
<ul>
<li class="chapter" data-level="5.1" data-path="summary-of-solution-design.html"><a href="summary-of-solution-design.html#glossary-and-definitions"><i class="fa fa-check"></i><b>5.1</b> Glossary and Definitions</a></li>
<li class="chapter" data-level="5.2" data-path="summary-of-solution-design.html"><a href="summary-of-solution-design.html#access-clean-and-wrangle-data"><i class="fa fa-check"></i><b>5.2</b> Access, Clean, and Wrangle Data</a></li>
<li class="chapter" data-level="5.3" data-path="summary-of-solution-design.html"><a href="summary-of-solution-design.html#analysis-and-visualizations"><i class="fa fa-check"></i><b>5.3</b> Analysis and Visualizations</a></li>
<li class="chapter" data-level="5.4" data-path="summary-of-solution-design.html"><a href="summary-of-solution-design.html#outdoor-equity-app"><i class="fa fa-check"></i><b>5.4</b> Outdoor Equity App</a></li>
<li class="chapter" data-level="5.5" data-path="summary-of-solution-design.html"><a href="summary-of-solution-design.html#user-guide-and-technical-documentation"><i class="fa fa-check"></i><b>5.5</b> User Guide and Technical Documentation</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="products-and-deliverables.html"><a href="products-and-deliverables.html"><i class="fa fa-check"></i><b>6</b> Products and Deliverables</a>
<ul>
<li class="chapter" data-level="6.1" data-path="products-and-deliverables.html"><a href="products-and-deliverables.html#r-shiny-app"><i class="fa fa-check"></i><b>6.1</b> R Shiny App</a></li>
<li class="chapter" data-level="6.2" data-path="products-and-deliverables.html"><a href="products-and-deliverables.html#metadata"><i class="fa fa-check"></i><b>6.2</b> Metadata</a></li>
<li class="chapter" data-level="6.3" data-path="products-and-deliverables.html"><a href="products-and-deliverables.html#packages-and-versions-used"><i class="fa fa-check"></i><b>6.3</b> Packages and Versions Used</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="summary-of-testing.html"><a href="summary-of-testing.html"><i class="fa fa-check"></i><b>7</b> Summary of Testing</a>
<ul>
<li class="chapter" data-level="7.1" data-path="summary-of-testing.html"><a href="summary-of-testing.html#data-integrity"><i class="fa fa-check"></i><b>7.1</b> Data Integrity</a></li>
<li class="chapter" data-level="7.2" data-path="summary-of-testing.html"><a href="summary-of-testing.html#code-review"><i class="fa fa-check"></i><b>7.2</b> Code Review</a></li>
<li class="chapter" data-level="7.3" data-path="summary-of-testing.html"><a href="summary-of-testing.html#product-testing"><i class="fa fa-check"></i><b>7.3</b> Product Testing</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="summary-of-testing.html"><a href="summary-of-testing.html#next-steps-for-testing"><i class="fa fa-check"></i><b>7.3.1</b> Next steps for testing</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="user-documentation.html"><a href="user-documentation.html"><i class="fa fa-check"></i><b>8</b> User Documentation</a>
<ul>
<li class="chapter" data-level="8.1" data-path="user-documentation.html"><a href="user-documentation.html#purpose-of-the-outdoor-equity-app"><i class="fa fa-check"></i><b>8.1</b> Purpose of the Outdoor Equity App</a></li>
<li class="chapter" data-level="8.2" data-path="user-documentation.html"><a href="user-documentation.html#how-to-use-the-outdoor-equity-app"><i class="fa fa-check"></i><b>8.2</b> How to Use the Outdoor Equity App</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="user-documentation.html"><a href="user-documentation.html#about-the-app"><i class="fa fa-check"></i><b>8.2.1</b> About the App</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="user-documentation.html"><a href="user-documentation.html#how-to-maintain-the-outdoor-equity-app"><i class="fa fa-check"></i><b>8.3</b> How to Maintain the Outdoor Equity App</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="user-documentation.html"><a href="user-documentation.html#repository-directory-structure"><i class="fa fa-check"></i><b>8.3.1</b> Repository Directory Structure</a></li>
<li class="chapter" data-level="8.3.2" data-path="user-documentation.html"><a href="user-documentation.html#data-preparation-methods"><i class="fa fa-check"></i><b>8.3.2</b> Data Preparation Methods</a></li>
<li class="chapter" data-level="8.3.3" data-path="user-documentation.html"><a href="user-documentation.html#statistical-analysis-and-data-wrangling-for-plots"><i class="fa fa-check"></i><b>8.3.3</b> Statistical Analysis and Data Wrangling for Plots</a></li>
<li class="chapter" data-level="8.3.4" data-path="user-documentation.html"><a href="user-documentation.html#data-updates"><i class="fa fa-check"></i><b>8.3.4</b> Data updates</a></li>
<li class="chapter" data-level="8.3.5" data-path="user-documentation.html"><a href="user-documentation.html#server-hosting"><i class="fa fa-check"></i><b>8.3.5</b> Server Hosting</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="user-documentation.html"><a href="user-documentation.html#how-to-expand-the-outdoor-equity-app"><i class="fa fa-check"></i><b>8.4</b> How to Expand the Outdoor Equity App</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="user-documentation.html"><a href="user-documentation.html#temporal-expansions"><i class="fa fa-check"></i><b>8.4.1</b> Temporal Expansions</a></li>
<li class="chapter" data-level="8.4.2" data-path="user-documentation.html"><a href="user-documentation.html#spatial-expansions"><i class="fa fa-check"></i><b>8.4.2</b> Spatial Expansions</a></li>
<li class="chapter" data-level="8.4.3" data-path="user-documentation.html"><a href="user-documentation.html#statistical-analysis"><i class="fa fa-check"></i><b>8.4.3</b> Statistical Analysis</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="additional-challenges.html"><a href="additional-challenges.html"><i class="fa fa-check"></i><b>9</b> Additional Challenges</a>
<ul>
<li class="chapter" data-level="9.1" data-path="additional-challenges.html"><a href="additional-challenges.html#data-limitations"><i class="fa fa-check"></i><b>9.1</b> Data Limitations</a></li>
<li class="chapter" data-level="9.2" data-path="additional-challenges.html"><a href="additional-challenges.html#technical-challenges"><i class="fa fa-check"></i><b>9.2</b> Technical Challenges</a></li>
<li class="chapter" data-level="9.3" data-path="additional-challenges.html"><a href="additional-challenges.html#future-challenges"><i class="fa fa-check"></i><b>9.3</b> Future Challenges</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="appedix.html"><a href="appedix.html"><i class="fa fa-check"></i>Appedix</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Outdoor Equity App Technical Documentation</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="user-documentation" class="section level1" number="8">
<h1><span class="header-section-number">Section 8</span> User Documentation</h1>
<div id="purpose-of-the-outdoor-equity-app" class="section level2" number="8.1">
<h2><span class="header-section-number">8.1</span> Purpose of the Outdoor Equity App</h2>
<p>The <a href="https://shinyapps.bren.ucsb.edu/oe_app/">Outdoor Equity App</a> provides users with tools to explore trends at different overnight reservable sites to analyze access to these sites. The intended audience is federal public land managers and researchers as well as nonprofit organizations and recreation users.</p>
<p>The <a href="https://ridb.recreation.gov/landing">Recreation Information Database (RIDB) data</a> are comprehensive when it comes to information regarding the site and reservation, but do not include information about the visitor outside of their home ZIP code. <a href="https://www.census.gov/programs-surveys/acs/data.html">US Census American Community Survey (ACS) data</a> is used to approximate socioeconomic demographics by joining information about the visitors’ home ZIP code to the RIDB data.</p>
</div>
<div id="how-to-use-the-outdoor-equity-app" class="section level2" number="8.2">
<h2><span class="header-section-number">8.2</span> How to Use the Outdoor Equity App</h2>
<div id="about-the-app" class="section level3" number="8.2.1">
<h3><span class="header-section-number">8.2.1</span> About the App</h3>
<p>The About tab of the <a href="https://shinyapps.bren.ucsb.edu/oe_app/">Outdoor Equity App</a> includes background information about what the App is, why outdoor recreation is important, the App creators, and what data is used in the App. These sections are similar to the <a href="index.html#about">About Section</a> of this technical documentation. The About tab also includes example questions that a user might explore through the different parts of the Analysis tab.</p>
<p>The Analysis tab of the App consists of three parts Data Summary, Data Relationship and Visitorshed Maps. Each of these pages includes a brief explanatory section of how to interpret the plot or graph, a section to subset the data to the desired campsite, and the plot or map outputs.</p>
<p>The Metadata tab of the App includes metadata for all variables in the combined RIDB and ACS dataset. This section mirrors the Metadata section in the <a href="products-and-deliverables.html#products-and-deliverables">Products and Deliverables Section</a> of this document.</p>
<p>The Data Download section of the App allows a user to download a subset of data include as many or as few campsites and variables as they require for further analysis or use.</p>
</div>
</div>
<div id="how-to-maintain-the-outdoor-equity-app" class="section level2" number="8.3">
<h2><span class="header-section-number">8.3</span> How to Maintain the Outdoor Equity App</h2>
<div id="repository-directory-structure" class="section level3" number="8.3.1">
<h3><span class="header-section-number">8.3.1</span> Repository Directory Structure</h3>
<p>Our code is version controlled in a <a href="https://github.com/outdoor-equity/outdoor-equity">GitHub repository</a>. This includes the data cleaning, wrangling, and analysis, creation of plots and maps, and structure of the shiny app. An overview of the directory structure can be seen below:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="user-documentation.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add image of repo diagram</span></span></code></pre></div>
</div>
<div id="data-preparation-methods" class="section level3" number="8.3.2">
<h3><span class="header-section-number">8.3.2</span> Data Preparation Methods</h3>
<div id="ridb-data" class="section level4" number="8.3.2.1">
<h4><span class="header-section-number">8.3.2.1</span> RIDB Data</h4>
<p><a href="https://ridb.recreation.gov/landing">RIDB data</a> data are available through direct download as CSV files or via the API as JSON files via Recreation.gov. API access requires creating a Recreation.gov account and requesting second tier API access via the Recreation.gov website’s <a href="https://recreationonestopprod.servicenowservices.com/external?id=external_contact_us">Contact Us</a> page. CSV files are readily available for download via the <a href="https://ridb.recreation.gov/download">Recreation.gov website</a>. Data are collected each time a visitor makes a reservation through Recreation.gov. Data packages are posted annually in the spring by Recreation One Stop (R1S) and contain the previous fiscal year’s reservations (ex: the 2018 package includes 2018-10-01 through 2018-09-30). Data packages are available for download from 2006 to present. Each annual data package file contains a range between 2 million and 5 million observations (or reservations) and includes variables in character, numeric, and date/time formats about each reservation. A shift in the data collection and storage processes occurred in 2019, changing what variables are available and how they are labeled. Currently, the Outdoor Equity App contains only data for reservable sites in California and reservations for fiscal year 2018 due to time limitations of this project. To see more about expanding the App temporally and spatially see the <a href="user-documentation.html#how-to-expand-the-outdoor-equity-app">How to Expand the Outdoor Equity App Section</a>.</p>
<p>We created a reproducible workflow for cleaning and wrangling data, which is employed in the <code>data_wrangle_and_clean.Rmd</code> document that sources custom functions to prepare RIDB data for joining with ACS data. All custom functions are listed in the <a href="summary-of-solution-design.html#access-clean-and-wrangle-data">Access, Clean, and Wrangle Data Section</a> of this document. These functions rely heavily on functions from the <code>tidyverse</code> collection of packages <span class="citation">(<a href="#ref-R-tidyverse" role="doc-biblioref">Wickham 2021</a>)</span>.</p>
<p>First, we use the <code>function_ridb_subset-pre2018.R</code> to subset the RIDB data, filtering only reservations within the selected state that are listed as “Overnight” reservations within the <code>use_type</code> variable. For the 2018 California dataset this results in a starting “raw” data frame with 521,682 reservations</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="user-documentation.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># filter for state</span></span>
<span id="cb2-2"><a href="user-documentation.html#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(facility_state <span class="sc">==</span> state_abbrev) <span class="sc">%&gt;%</span></span>
<span id="cb2-3"><a href="user-documentation.html#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter for use type</span></span>
<span id="cb2-4"><a href="user-documentation.html#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(use_type <span class="sc">==</span> <span class="st">&quot;Overnight&quot;</span>)</span></code></pre></div>
<p>We then select only the necessary variables, including information about the site (agency, park or forest name, site name, site type, and site location) and information about the reservation (home ZIP come, total paid, visit start and end dates, visit order date, and number of people in party).</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="user-documentation.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># select variables</span></span>
<span id="cb3-2"><a href="user-documentation.html#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(<span class="fu">c</span>(<span class="st">&quot;agency&quot;</span>, <span class="st">&quot;parent_location&quot;</span>, <span class="st">&quot;region_description&quot;</span>, </span>
<span id="cb3-3"><a href="user-documentation.html#cb3-3" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;park&quot;</span>, <span class="st">&quot;site_type&quot;</span>, <span class="st">&quot;facility_id&quot;</span>, <span class="st">&quot;facility_state&quot;</span>, </span>
<span id="cb3-4"><a href="user-documentation.html#cb3-4" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;facility_longitude&quot;</span>, <span class="st">&quot;facility_latitude&quot;</span>, </span>
<span id="cb3-5"><a href="user-documentation.html#cb3-5" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;customer_zip&quot;</span>, <span class="st">&quot;total_paid&quot;</span>, <span class="st">&quot;start_date&quot;</span>,</span>
<span id="cb3-6"><a href="user-documentation.html#cb3-6" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;end_date&quot;</span>, <span class="st">&quot;order_date&quot;</span>, <span class="st">&quot;number_of_people&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb3-7"><a href="user-documentation.html#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">site_type =</span> <span class="fu">tolower</span>(site_type)) <span class="sc">%&gt;%</span></span>
<span id="cb3-8"><a href="user-documentation.html#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>site_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;historic tour&quot;</span>, <span class="st">&quot;hiking zone&quot;</span>, </span>
<span id="cb3-9"><a href="user-documentation.html#cb3-9" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;group picnic area&quot;</span>, <span class="st">&quot;cave tour&quot;</span>,</span>
<span id="cb3-10"><a href="user-documentation.html#cb3-10" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;management&quot;</span>, <span class="st">&quot;picnic&quot;</span>, </span>
<span id="cb3-11"><a href="user-documentation.html#cb3-11" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;entry point&quot;</span>, <span class="st">&quot;trailhead&quot;</span>))</span></code></pre></div>
<p>Next we normalize the customer ZIP code values. This includes filtering for only US ZIP codes and shortening all 9 digit ZIP codes to include only the first 5 digits.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="user-documentation.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># filter out invalid ZIP codes</span></span>
<span id="cb4-2"><a href="user-documentation.html#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(<span class="fu">str_detect</span>(<span class="at">string =</span> customer_zip,</span>
<span id="cb4-3"><a href="user-documentation.html#cb4-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">pattern =</span> <span class="st">&quot;^[:digit:]{5}(?!.)&quot;</span>) <span class="sc">|</span></span>
<span id="cb4-4"><a href="user-documentation.html#cb4-4" aria-hidden="true" tabindex="-1"></a>         <span class="fu">str_detect</span>(<span class="at">string =</span> customer_zip,</span>
<span id="cb4-5"><a href="user-documentation.html#cb4-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">pattern =</span> <span class="st">&quot;^[:digit:]{5}(?=-)&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb4-6"><a href="user-documentation.html#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>customer_zip <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;00000&quot;</span>, <span class="st">&quot;99999&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb4-7"><a href="user-documentation.html#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">customer_zip =</span> <span class="fu">str_extract</span>(<span class="at">string =</span> customer_zip,</span>
<span id="cb4-8"><a href="user-documentation.html#cb4-8" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">pattern =</span> <span class="st">&quot;[:digit:]{5}&quot;</span>))</span></code></pre></div>
<p>This function results in the removal of 24,866 reservations (or 4.77%) from the original “raw” dataset that included all reservations for reservable overnight campsites in California.</p>
<p>We created a second custom function <code>function_ridb_variable_calculate-pre2018.R</code> to calculate and manipulate variables of interest. We use start, end, and order dates to calculate the lengths of stay and booking windows (number of days from order to start date) of each reservation. The booking window calculations return a number of results that are negative. This is a known issue that others working with the RIDB data have encountered. This resulted in 4,530 reservations (or 0.87%) without a valid booking window, which are removed for plots that visualize the booking window variable.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="user-documentation.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">start_date =</span> <span class="fu">as.Date</span>(start_date),</span>
<span id="cb5-2"><a href="user-documentation.html#cb5-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">end_date =</span> <span class="fu">as.Date</span>(end_date),</span>
<span id="cb5-3"><a href="user-documentation.html#cb5-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">order_date =</span> <span class="fu">as.Date</span>(order_date),</span>
<span id="cb5-4"><a href="user-documentation.html#cb5-4" aria-hidden="true" tabindex="-1"></a>       <span class="co"># calculate new variables</span></span>
<span id="cb5-5"><a href="user-documentation.html#cb5-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">length_of_stay =</span> <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(end_date, start_date), </span>
<span id="cb5-6"><a href="user-documentation.html#cb5-6" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">units =</span> <span class="st">&quot;days&quot;</span>),</span>
<span id="cb5-7"><a href="user-documentation.html#cb5-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">booking_window =</span> <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(start_date, order_date), </span>
<span id="cb5-8"><a href="user-documentation.html#cb5-8" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">units =</span> <span class="st">&quot;days&quot;</span>))</span></code></pre></div>
<p>We calculate daily cost per reservation by dividing total costs by lengths of stay. We then calculated daily cost per visitor by dividing the daily cost by the number of visitors.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="user-documentation.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate new variables</span></span>
<span id="cb6-2"><a href="user-documentation.html#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">daily_cost =</span> total_paid <span class="sc">/</span> length_of_stay,</span>
<span id="cb6-3"><a href="user-documentation.html#cb6-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">daily_cost_per_visitor =</span> daily_cost <span class="sc">/</span> number_of_people)</span></code></pre></div>
<p>We aggregate the <code>site_type</code> variable to create 7 broader site categories.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="user-documentation.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># aggregate site type</span></span>
<span id="cb7-2"><a href="user-documentation.html#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">aggregated_site_type =</span> </span>
<span id="cb7-3"><a href="user-documentation.html#cb7-3" aria-hidden="true" tabindex="-1"></a>         <span class="fu">case_when</span>(site_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;walk to&quot;</span>, <span class="st">&quot;hike to&quot;</span>, </span>
<span id="cb7-4"><a href="user-documentation.html#cb7-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">&quot;group hike to&quot;</span>, <span class="st">&quot;group walk to&quot;</span></span>
<span id="cb7-5"><a href="user-documentation.html#cb7-5" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">~</span> <span class="st">&quot;remote&quot;</span>,</span>
<span id="cb7-6"><a href="user-documentation.html#cb7-6" aria-hidden="true" tabindex="-1"></a>         site_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;cabin nonelectric&quot;</span>, <span class="st">&quot;cabin electric&quot;</span>, </span>
<span id="cb7-7"><a href="user-documentation.html#cb7-7" aria-hidden="true" tabindex="-1"></a>                          <span class="st">&quot;yurt&quot;</span>,<span class="st">&quot;shelter nonelectric&quot;</span></span>
<span id="cb7-8"><a href="user-documentation.html#cb7-8" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">~</span> <span class="st">&quot;shelter&quot;</span>,</span>
<span id="cb7-9"><a href="user-documentation.html#cb7-9" aria-hidden="true" tabindex="-1"></a>         site_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;boat in&quot;</span>, <span class="st">&quot;anchorage&quot;</span>) <span class="sc">~</span> <span class="st">&quot;water&quot;</span>,</span>
<span id="cb7-10"><a href="user-documentation.html#cb7-10" aria-hidden="true" tabindex="-1"></a>         site_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;group equestrian&quot;</span>, </span>
<span id="cb7-11"><a href="user-documentation.html#cb7-11" aria-hidden="true" tabindex="-1"></a>                          <span class="st">&quot;equestrian nonelectric&quot;</span></span>
<span id="cb7-12"><a href="user-documentation.html#cb7-12" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">~</span> <span class="st">&quot;equestrian&quot;</span>,</span>
<span id="cb7-13"><a href="user-documentation.html#cb7-13" aria-hidden="true" tabindex="-1"></a>         site_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;rv nonelectric&quot;</span>, <span class="st">&quot;rv electric&quot;</span>, </span>
<span id="cb7-14"><a href="user-documentation.html#cb7-14" aria-hidden="true" tabindex="-1"></a>                          <span class="st">&quot;group rv area nonelectric&quot;</span></span>
<span id="cb7-15"><a href="user-documentation.html#cb7-15" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">~</span> <span class="st">&quot;rv only&quot;</span>,</span>
<span id="cb7-16"><a href="user-documentation.html#cb7-16" aria-hidden="true" tabindex="-1"></a>         site_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;group standard nonelectric&quot;</span>, </span>
<span id="cb7-17"><a href="user-documentation.html#cb7-17" aria-hidden="true" tabindex="-1"></a>                          <span class="st">&quot;standard nonelectric&quot;</span>,</span>
<span id="cb7-18"><a href="user-documentation.html#cb7-18" aria-hidden="true" tabindex="-1"></a>                          <span class="st">&quot;standard electric&quot;</span>, </span>
<span id="cb7-19"><a href="user-documentation.html#cb7-19" aria-hidden="true" tabindex="-1"></a>                          <span class="st">&quot;group standard area nonelectric&quot;</span>,</span>
<span id="cb7-20"><a href="user-documentation.html#cb7-20" aria-hidden="true" tabindex="-1"></a>                          <span class="st">&quot;group standard electric&quot;</span></span>
<span id="cb7-21"><a href="user-documentation.html#cb7-21" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">~</span> <span class="st">&quot;rv or tent&quot;</span>,</span>
<span id="cb7-22"><a href="user-documentation.html#cb7-22" aria-hidden="true" tabindex="-1"></a>         site_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;tent only nonelectric&quot;</span>, </span>
<span id="cb7-23"><a href="user-documentation.html#cb7-23" aria-hidden="true" tabindex="-1"></a>                          <span class="st">&quot;group tent only area nonelectric&quot;</span>,</span>
<span id="cb7-24"><a href="user-documentation.html#cb7-24" aria-hidden="true" tabindex="-1"></a>                          <span class="st">&quot;tent only electric&quot;</span></span>
<span id="cb7-25"><a href="user-documentation.html#cb7-25" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">~</span> <span class="st">&quot;tent only&quot;</span>))</span></code></pre></div>
<p>We create an administrative unit variable by combining the <code>parent_location</code> and <code>region_description</code> variables as different federal agencies track the administrative unit information within different variables. Then we update the <code>agency</code>, <code>admin_uni</code> and <code>park</code> variable character strings using multiple functions from the <code>stringr</code> package <span class="citation">(<a href="#ref-R-stringr" role="doc-biblioref">Wickham 2019</a>)</span>. These updates expand acronyms, remove unnecessary characters (such as “–” or location codes), and normalize any discrepencies in characater strings.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="user-documentation.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">admin_unit =</span> </span>
<span id="cb8-2"><a href="user-documentation.html#cb8-2" aria-hidden="true" tabindex="-1"></a>         <span class="fu">case_when</span>(agency <span class="sc">==</span> <span class="st">&quot;USFS&quot;</span> <span class="sc">~</span> parent_location,</span>
<span id="cb8-3"><a href="user-documentation.html#cb8-3" aria-hidden="true" tabindex="-1"></a>                   agency <span class="sc">%in%</span> <span class="fu">c</span>(</span>
<span id="cb8-4"><a href="user-documentation.html#cb8-4" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;NPS&quot;</span>, <span class="st">&quot;BOR&quot;</span>, <span class="st">&quot;USACE&quot;</span></span>
<span id="cb8-5"><a href="user-documentation.html#cb8-5" aria-hidden="true" tabindex="-1"></a>                   ) <span class="sc">~</span> region_description)) <span class="sc">%&gt;%</span> </span>
<span id="cb8-6"><a href="user-documentation.html#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># edit values</span></span>
<span id="cb8-7"><a href="user-documentation.html#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb8-8"><a href="user-documentation.html#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># agency abbreviations to names</span></span>
<span id="cb8-9"><a href="user-documentation.html#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">agency =</span> <span class="fu">str_replace</span>(<span class="at">string =</span> agency,</span>
<span id="cb8-10"><a href="user-documentation.html#cb8-10" aria-hidden="true" tabindex="-1"></a>                         <span class="at">pattern =</span> <span class="st">&quot;NPS&quot;</span>,</span>
<span id="cb8-11"><a href="user-documentation.html#cb8-11" aria-hidden="true" tabindex="-1"></a>                         <span class="at">replacement =</span> <span class="st">&quot;National Park Service&quot;</span>),</span>
<span id="cb8-12"><a href="user-documentation.html#cb8-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">agency =</span> <span class="fu">str_replace</span>(<span class="at">string =</span> agency,</span>
<span id="cb8-13"><a href="user-documentation.html#cb8-13" aria-hidden="true" tabindex="-1"></a>                         <span class="at">pattern =</span> <span class="st">&quot;USFS&quot;</span>, </span>
<span id="cb8-14"><a href="user-documentation.html#cb8-14" aria-hidden="true" tabindex="-1"></a>                         <span class="at">replacement =</span> <span class="st">&quot;US Forest Service&quot;</span>),</span>
<span id="cb8-15"><a href="user-documentation.html#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">agency =</span> <span class="fu">str_replace</span>(<span class="at">string =</span> agency,</span>
<span id="cb8-16"><a href="user-documentation.html#cb8-16" aria-hidden="true" tabindex="-1"></a>                         <span class="at">pattern =</span> <span class="st">&quot;USACE&quot;</span>,</span>
<span id="cb8-17"><a href="user-documentation.html#cb8-17" aria-hidden="true" tabindex="-1"></a>                         <span class="at">replacement =</span> <span class="st">&quot;US Army Corps of Engineers&quot;</span>),</span>
<span id="cb8-18"><a href="user-documentation.html#cb8-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">agency =</span> <span class="fu">str_replace</span>(<span class="at">string =</span> agency,</span>
<span id="cb8-19"><a href="user-documentation.html#cb8-19" aria-hidden="true" tabindex="-1"></a>                         <span class="at">pattern =</span> <span class="st">&quot;BOR&quot;</span>,</span>
<span id="cb8-20"><a href="user-documentation.html#cb8-20" aria-hidden="true" tabindex="-1"></a>                         <span class="at">replacement =</span> <span class="st">&quot;Bureau of Reclamation&quot;</span>),</span>
<span id="cb8-21"><a href="user-documentation.html#cb8-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># update admin_unit values (generic)</span></span>
<span id="cb8-22"><a href="user-documentation.html#cb8-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">admin_unit =</span> <span class="fu">str_replace</span>(<span class="at">string =</span> admin_unit,</span>
<span id="cb8-23"><a href="user-documentation.html#cb8-23" aria-hidden="true" tabindex="-1"></a>                             <span class="at">pattern =</span> <span class="fu">paste</span>(<span class="fu">c</span>(<span class="st">&quot;NF - FS&quot;</span>, <span class="st">&quot;NF -FS&quot;</span>, </span>
<span id="cb8-24"><a href="user-documentation.html#cb8-24" aria-hidden="true" tabindex="-1"></a>                                               <span class="st">&quot;NF- FS&quot;</span>, <span class="st">&quot;NF-FS&quot;</span>, </span>
<span id="cb8-25"><a href="user-documentation.html#cb8-25" aria-hidden="true" tabindex="-1"></a>                                               <span class="st">&quot;-FS&quot;</span>, <span class="st">&quot; - FS&quot;</span>), </span>
<span id="cb8-26"><a href="user-documentation.html#cb8-26" aria-hidden="true" tabindex="-1"></a>                                             <span class="at">collapse =</span> <span class="st">&quot;|&quot;</span>),</span>
<span id="cb8-27"><a href="user-documentation.html#cb8-27" aria-hidden="true" tabindex="-1"></a>                             <span class="at">replacement =</span> <span class="st">&quot;National Forest&quot;</span>),</span>
<span id="cb8-28"><a href="user-documentation.html#cb8-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">admin_unit =</span> <span class="fu">str_to_title</span>(admin_unit),</span>
<span id="cb8-29"><a href="user-documentation.html#cb8-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">admin_unit =</span> <span class="fu">str_replace</span>(<span class="at">string =</span> admin_unit,</span>
<span id="cb8-30"><a href="user-documentation.html#cb8-30" aria-hidden="true" tabindex="-1"></a>                             <span class="at">pattern =</span> <span class="st">&quot;And&quot;</span>,</span>
<span id="cb8-31"><a href="user-documentation.html#cb8-31" aria-hidden="true" tabindex="-1"></a>                             <span class="at">replacement =</span> <span class="st">&quot;&amp;&quot;</span>),</span>
<span id="cb8-32"><a href="user-documentation.html#cb8-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># update park values (generic)</span></span>
<span id="cb8-33"><a href="user-documentation.html#cb8-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">park =</span> <span class="fu">str_remove</span>(<span class="at">string =</span> park,</span>
<span id="cb8-34"><a href="user-documentation.html#cb8-34" aria-hidden="true" tabindex="-1"></a>                      <span class="at">pattern =</span> <span class="fu">paste</span>(<span class="fu">c</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">(.*&quot;</span>, <span class="st">&quot; </span><span class="sc">\\</span><span class="st">(.*&quot;</span>,</span>
<span id="cb8-35"><a href="user-documentation.html#cb8-35" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">&quot;---.*&quot;</span>, <span class="st">&quot; ---.*&quot;</span>,</span>
<span id="cb8-36"><a href="user-documentation.html#cb8-36" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">&quot;,.*&quot;</span>), </span>
<span id="cb8-37"><a href="user-documentation.html#cb8-37" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">collapse =</span> <span class="st">&quot;|&quot;</span>)),</span>
<span id="cb8-38"><a href="user-documentation.html#cb8-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">park =</span> <span class="fu">str_to_title</span>(park),</span>
<span id="cb8-39"><a href="user-documentation.html#cb8-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">park =</span> <span class="fu">str_replace</span>(<span class="at">string =</span> park,</span>
<span id="cb8-40"><a href="user-documentation.html#cb8-40" aria-hidden="true" tabindex="-1"></a>                       <span class="at">pattern =</span> <span class="st">&quot;Cg&quot;</span>,</span>
<span id="cb8-41"><a href="user-documentation.html#cb8-41" aria-hidden="true" tabindex="-1"></a>                       <span class="at">replacement =</span> <span class="st">&quot;Campground&quot;</span>),</span>
<span id="cb8-42"><a href="user-documentation.html#cb8-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">park =</span> <span class="fu">str_replace</span>(<span class="at">string =</span> park,</span>
<span id="cb8-43"><a href="user-documentation.html#cb8-43" aria-hidden="true" tabindex="-1"></a>                       <span class="at">pattern =</span> <span class="st">&quot;Nhp&quot;</span>,</span>
<span id="cb8-44"><a href="user-documentation.html#cb8-44" aria-hidden="true" tabindex="-1"></a>                       <span class="at">replacement =</span> <span class="st">&quot;National Historic Park&quot;</span>),</span>
<span id="cb8-45"><a href="user-documentation.html#cb8-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">park =</span> <span class="fu">str_replace</span>(<span class="at">string =</span> park,</span>
<span id="cb8-46"><a href="user-documentation.html#cb8-46" aria-hidden="true" tabindex="-1"></a>                       <span class="at">pattern =</span> <span class="st">&quot;@&quot;</span>,</span>
<span id="cb8-47"><a href="user-documentation.html#cb8-47" aria-hidden="true" tabindex="-1"></a>                       <span class="at">replacement =</span> <span class="st">&quot;At&quot;</span>),</span>
<span id="cb8-48"><a href="user-documentation.html#cb8-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">park =</span> <span class="fu">str_replace</span>(<span class="at">string =</span> park,</span>
<span id="cb8-49"><a href="user-documentation.html#cb8-49" aria-hidden="true" tabindex="-1"></a>                       <span class="at">pattern =</span> <span class="st">&quot;&amp;&quot;</span>,</span>
<span id="cb8-50"><a href="user-documentation.html#cb8-50" aria-hidden="true" tabindex="-1"></a>                       <span class="at">replacement =</span> <span class="st">&quot;And&quot;</span>),</span>
<span id="cb8-51"><a href="user-documentation.html#cb8-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">park =</span> <span class="fu">str_replace</span>(<span class="at">string =</span> park,</span>
<span id="cb8-52"><a href="user-documentation.html#cb8-52" aria-hidden="true" tabindex="-1"></a>                       <span class="at">pattern =</span> <span class="fu">paste</span>(<span class="fu">c</span>(<span class="st">&quot;/&quot;</span>, <span class="st">&quot; / &quot;</span>), <span class="at">collapse =</span> <span class="st">&quot;|&quot;</span>),</span>
<span id="cb8-53"><a href="user-documentation.html#cb8-53" aria-hidden="true" tabindex="-1"></a>                       <span class="at">replacement =</span> <span class="st">&quot; &quot;</span>),</span>
<span id="cb8-54"><a href="user-documentation.html#cb8-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">park =</span> <span class="fu">str_remove_all</span>(<span class="at">string =</span> park,</span>
<span id="cb8-55"><a href="user-documentation.html#cb8-55" aria-hidden="true" tabindex="-1"></a>                          <span class="at">pattern =</span> <span class="st">&quot; </span><span class="sc">\\</span><span class="st">d.*&quot;</span>),</span>
<span id="cb8-56"><a href="user-documentation.html#cb8-56" aria-hidden="true" tabindex="-1"></a>    <span class="co"># update park values (CA specific)</span></span>
<span id="cb8-57"><a href="user-documentation.html#cb8-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">park =</span> <span class="fu">str_remove</span>(<span class="at">string =</span> park,</span>
<span id="cb8-58"><a href="user-documentation.html#cb8-58" aria-hidden="true" tabindex="-1"></a>                      <span class="at">pattern =</span> <span class="fu">paste</span>(<span class="fu">c</span>(<span class="st">&quot; - Angeles Nf&quot;</span>, <span class="st">&quot; -Hwy&quot;</span>), </span>
<span id="cb8-59"><a href="user-documentation.html#cb8-59" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">collapse =</span> <span class="st">&quot;|&quot;</span>)),</span>
<span id="cb8-60"><a href="user-documentation.html#cb8-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">park =</span> <span class="fu">str_replace</span>(<span class="at">string =</span> park,</span>
<span id="cb8-61"><a href="user-documentation.html#cb8-61" aria-hidden="true" tabindex="-1"></a>                       <span class="at">pattern =</span> <span class="st">&quot;Tunnel Mills Il&quot;</span>,</span>
<span id="cb8-62"><a href="user-documentation.html#cb8-62" aria-hidden="true" tabindex="-1"></a>                       <span class="at">replacement =</span> <span class="st">&quot;Tunnel Mills&quot;</span>))</span></code></pre></div>
<p>We calculate distance traveled by measuring the distance from the latitude and longitude coordinate facility locations to the centroid of the home ZIP code. Here we utilize both the <code>tidycensus</code> package <span class="citation">(<a href="#ref-R-tidycensus" role="doc-biblioref">Walker and Herman 2021</a>)</span> and the <code>sf</code> package <span class="citation">(<a href="#ref-R-sf" role="doc-biblioref">Pebesma 2022</a>)</span>.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="user-documentation.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># bootstrap geometries and reproject to NAD 83</span></span>
<span id="cb9-2"><a href="user-documentation.html#cb9-2" aria-hidden="true" tabindex="-1"></a>df_geometries <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb9-3"><a href="user-documentation.html#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;facility_longitude&quot;</span>, <span class="st">&quot;facility_latitude&quot;</span>),</span>
<span id="cb9-4"><a href="user-documentation.html#cb9-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">crs =</span> <span class="dv">4326</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb9-5"><a href="user-documentation.html#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">4269</span>) <span class="co"># using NAD83 because measured in meters</span></span>
<span id="cb9-6"><a href="user-documentation.html#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="user-documentation.html#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co"># get centroid of geometries for all US ZIP codes </span></span>
<span id="cb9-8"><a href="user-documentation.html#cb9-8" aria-hidden="true" tabindex="-1"></a>df_zip_centroids_us <span class="ot">&lt;-</span> </span>
<span id="cb9-9"><a href="user-documentation.html#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_acs</span>(<span class="at">geography =</span> <span class="st">&quot;zcta&quot;</span>, <span class="at">year =</span> <span class="dv">2018</span>, </span>
<span id="cb9-10"><a href="user-documentation.html#cb9-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">geometry =</span> <span class="cn">TRUE</span>, </span>
<span id="cb9-11"><a href="user-documentation.html#cb9-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">summary_var =</span> <span class="st">&quot;B01001_001&quot;</span>,</span>
<span id="cb9-12"><a href="user-documentation.html#cb9-12" aria-hidden="true" tabindex="-1"></a>          <span class="at">survey =</span> <span class="st">&quot;acs5&quot;</span>,</span>
<span id="cb9-13"><a href="user-documentation.html#cb9-13" aria-hidden="true" tabindex="-1"></a>          <span class="at">variables =</span> <span class="fu">c</span>(<span class="at">male =</span> <span class="st">&quot;B01001_002&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb9-14"><a href="user-documentation.html#cb9-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(NAME, geometry) <span class="sc">%&gt;%</span> </span>
<span id="cb9-15"><a href="user-documentation.html#cb9-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">zip_code =</span> <span class="fu">str_sub</span>(NAME, <span class="at">start =</span> <span class="sc">-</span><span class="dv">5</span>, <span class="at">end =</span> <span class="sc">-</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb9-16"><a href="user-documentation.html#cb9-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(zip_code, geometry) <span class="sc">%&gt;%</span> </span>
<span id="cb9-17"><a href="user-documentation.html#cb9-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_centroid</span>()</span>
<span id="cb9-18"><a href="user-documentation.html#cb9-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-19"><a href="user-documentation.html#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="co"># join data and calculate `distance_traveled` variable</span></span>
<span id="cb9-20"><a href="user-documentation.html#cb9-20" aria-hidden="true" tabindex="-1"></a>df_joined_geometries <span class="ot">&lt;-</span> </span>
<span id="cb9-21"><a href="user-documentation.html#cb9-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="at">x =</span> df_geometries <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>(),</span>
<span id="cb9-22"><a href="user-documentation.html#cb9-22" aria-hidden="true" tabindex="-1"></a>            <span class="at">y =</span> df_zip_centroids_us <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>(), </span>
<span id="cb9-23"><a href="user-documentation.html#cb9-23" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;customer_zip&quot;</span> <span class="ot">=</span> <span class="st">&quot;zip_code&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb9-24"><a href="user-documentation.html#cb9-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_sf</span>(<span class="at">sf_column_name =</span> <span class="st">&#39;geometry.x&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb9-25"><a href="user-documentation.html#cb9-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">distance_traveled_m =</span> <span class="fu">st_distance</span>(<span class="at">x =</span> geometry.x, </span>
<span id="cb9-26"><a href="user-documentation.html#cb9-26" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">y =</span> geometry.y,</span>
<span id="cb9-27"><a href="user-documentation.html#cb9-27" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">by_element =</span> <span class="cn">TRUE</span>),</span>
<span id="cb9-28"><a href="user-documentation.html#cb9-28" aria-hidden="true" tabindex="-1"></a>         <span class="at">distance_traveled_m =</span> <span class="fu">as.numeric</span>(distance_traveled_m)) </span></code></pre></div>
<p>And finally, we add a variable indicating in which state or territory each customer zip code is located. This portion of the code utilizes the <code>zipcodeR</code> package <span class="citation">(<a href="#ref-R-zipcodeR" role="doc-biblioref">Rozzi 2021</a>)</span>.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="user-documentation.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create df of fips and full state names</span></span>
<span id="cb10-2"><a href="user-documentation.html#cb10-2" aria-hidden="true" tabindex="-1"></a>fips_list <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb10-3"><a href="user-documentation.html#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;01&quot;</span>, <span class="st">&quot;02&quot;</span>, <span class="st">&quot;04&quot;</span>, <span class="st">&quot;05&quot;</span>, <span class="st">&quot;06&quot;</span>, <span class="st">&quot;08&quot;</span>, <span class="st">&quot;09&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;11&quot;</span>, <span class="st">&quot;12&quot;</span>, </span>
<span id="cb10-4"><a href="user-documentation.html#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;13&quot;</span>, <span class="st">&quot;15&quot;</span>, <span class="st">&quot;16&quot;</span>, <span class="st">&quot;17&quot;</span>, <span class="st">&quot;18&quot;</span>, <span class="st">&quot;19&quot;</span>, <span class="st">&quot;20&quot;</span>, <span class="st">&quot;21&quot;</span>, <span class="st">&quot;22&quot;</span>, <span class="st">&quot;23&quot;</span>, </span>
<span id="cb10-5"><a href="user-documentation.html#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;24&quot;</span>, <span class="st">&quot;25&quot;</span>, <span class="st">&quot;26&quot;</span>, <span class="st">&quot;27&quot;</span>, <span class="st">&quot;28&quot;</span>, <span class="st">&quot;29&quot;</span>, <span class="st">&quot;30&quot;</span>, <span class="st">&quot;31&quot;</span>, <span class="st">&quot;32&quot;</span>, <span class="st">&quot;33&quot;</span>, </span>
<span id="cb10-6"><a href="user-documentation.html#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;34&quot;</span>, <span class="st">&quot;35&quot;</span>, <span class="st">&quot;36&quot;</span>, <span class="st">&quot;37&quot;</span>, <span class="st">&quot;38&quot;</span>, <span class="st">&quot;39&quot;</span>, <span class="st">&quot;40&quot;</span>, <span class="st">&quot;41&quot;</span>, <span class="st">&quot;42&quot;</span>, <span class="st">&quot;44&quot;</span>, </span>
<span id="cb10-7"><a href="user-documentation.html#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;45&quot;</span>, <span class="st">&quot;46&quot;</span>, <span class="st">&quot;47&quot;</span>, <span class="st">&quot;48&quot;</span>, <span class="st">&quot;49&quot;</span>, <span class="st">&quot;50&quot;</span>, <span class="st">&quot;51&quot;</span>, <span class="st">&quot;53&quot;</span>, <span class="st">&quot;54&quot;</span>, <span class="st">&quot;55&quot;</span>, </span>
<span id="cb10-8"><a href="user-documentation.html#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;56&quot;</span>, <span class="st">&quot;72&quot;</span>)</span>
<span id="cb10-9"><a href="user-documentation.html#cb10-9" aria-hidden="true" tabindex="-1"></a>state_list <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb10-10"><a href="user-documentation.html#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;AL&quot;</span>, <span class="st">&quot;AK&quot;</span>, <span class="st">&quot;AZ&quot;</span>, <span class="st">&quot;AR&quot;</span>, <span class="st">&quot;CA&quot;</span>, <span class="st">&quot;CO&quot;</span>, <span class="st">&quot;CT&quot;</span>, <span class="st">&quot;DE&quot;</span>, <span class="st">&quot;DC&quot;</span>, <span class="st">&quot;FL&quot;</span>,</span>
<span id="cb10-11"><a href="user-documentation.html#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;GA&quot;</span>, <span class="st">&quot;HI&quot;</span>, <span class="st">&quot;ID&quot;</span>, <span class="st">&quot;IL&quot;</span>, <span class="st">&quot;IN&quot;</span>, <span class="st">&quot;IA&quot;</span>, <span class="st">&quot;KS&quot;</span>, <span class="st">&quot;KY&quot;</span>, <span class="st">&quot;LA&quot;</span>, <span class="st">&quot;ME&quot;</span>,</span>
<span id="cb10-12"><a href="user-documentation.html#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;MD&quot;</span>, <span class="st">&quot;MA&quot;</span>, <span class="st">&quot;MI&quot;</span>, <span class="st">&quot;MN&quot;</span>, <span class="st">&quot;MS&quot;</span>, <span class="st">&quot;MO&quot;</span>, <span class="st">&quot;MT&quot;</span>, <span class="st">&quot;NE&quot;</span>, <span class="st">&quot;NV&quot;</span>, <span class="st">&quot;NH&quot;</span>,</span>
<span id="cb10-13"><a href="user-documentation.html#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;NJ&quot;</span>, <span class="st">&quot;NM&quot;</span>, <span class="st">&quot;NY&quot;</span>, <span class="st">&quot;NC&quot;</span>, <span class="st">&quot;ND&quot;</span>, <span class="st">&quot;OH&quot;</span>, <span class="st">&quot;OK&quot;</span>, <span class="st">&quot;OR&quot;</span>, <span class="st">&quot;PA&quot;</span>, <span class="st">&quot;RI&quot;</span>,</span>
<span id="cb10-14"><a href="user-documentation.html#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;SC&quot;</span>, <span class="st">&quot;SD&quot;</span>, <span class="st">&quot;TN&quot;</span>, <span class="st">&quot;TX&quot;</span>, <span class="st">&quot;UT&quot;</span>, <span class="st">&quot;VT&quot;</span>, <span class="st">&quot;VA&quot;</span>, <span class="st">&quot;WA&quot;</span>, <span class="st">&quot;WV&quot;</span>, <span class="st">&quot;WI&quot;</span>,</span>
<span id="cb10-15"><a href="user-documentation.html#cb10-15" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;WY&quot;</span>, <span class="st">&quot;PR&quot;</span>)</span>
<span id="cb10-16"><a href="user-documentation.html#cb10-16" aria-hidden="true" tabindex="-1"></a>states_names_list <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb10-17"><a href="user-documentation.html#cb10-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Alabama&quot;</span>, <span class="st">&quot;Alaska&quot;</span>, <span class="st">&quot;Arizona&quot;</span>, <span class="st">&quot;Arkansas&quot;</span>, <span class="st">&quot;California&quot;</span>, </span>
<span id="cb10-18"><a href="user-documentation.html#cb10-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Colorado&quot;</span>, <span class="st">&quot;Connecticut&quot;</span>, <span class="st">&quot;Delaware&quot;</span>, </span>
<span id="cb10-19"><a href="user-documentation.html#cb10-19" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;District of Columbia&quot;</span>, <span class="st">&quot;Florida&quot;</span>,<span class="st">&quot;Georgia&quot;</span>, <span class="st">&quot;Hawaii&quot;</span>, </span>
<span id="cb10-20"><a href="user-documentation.html#cb10-20" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Idaho&quot;</span>, <span class="st">&quot;Illinois&quot;</span>, <span class="st">&quot;Indiana&quot;</span>, <span class="st">&quot;Iowa&quot;</span>, <span class="st">&quot;Kansas&quot;</span>, </span>
<span id="cb10-21"><a href="user-documentation.html#cb10-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Kentucky&quot;</span>, <span class="st">&quot;Louisiana&quot;</span>, <span class="st">&quot;Maine&quot;</span>,<span class="st">&quot;Maryland&quot;</span>, </span>
<span id="cb10-22"><a href="user-documentation.html#cb10-22" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Massachusetts&quot;</span>, <span class="st">&quot;Michigan&quot;</span>, <span class="st">&quot;Minnesota&quot;</span>, <span class="st">&quot;Mississippi&quot;</span>, </span>
<span id="cb10-23"><a href="user-documentation.html#cb10-23" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Missouri&quot;</span>, <span class="st">&quot;Montana&quot;</span>, <span class="st">&quot;Nebraska&quot;</span>, <span class="st">&quot;Nevada&quot;</span>, <span class="st">&quot;New Hampshire&quot;</span>,</span>
<span id="cb10-24"><a href="user-documentation.html#cb10-24" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;New Jersey&quot;</span>, <span class="st">&quot;New Mexico&quot;</span>, <span class="st">&quot;New York&quot;</span>, <span class="st">&quot;North Carolina&quot;</span>, </span>
<span id="cb10-25"><a href="user-documentation.html#cb10-25" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;North Dakota&quot;</span>, <span class="st">&quot;Ohio&quot;</span>, <span class="st">&quot;Oklahoma&quot;</span>, <span class="st">&quot;Oregon&quot;</span>, <span class="st">&quot;Pennsylvania&quot;</span>, </span>
<span id="cb10-26"><a href="user-documentation.html#cb10-26" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Rhode Island&quot;</span>,<span class="st">&quot;South Carolina&quot;</span>, <span class="st">&quot;South Dakota&quot;</span>, <span class="st">&quot;Tennessee&quot;</span>, </span>
<span id="cb10-27"><a href="user-documentation.html#cb10-27" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Texas&quot;</span>, <span class="st">&quot;Utah&quot;</span>, <span class="st">&quot;Vermont&quot;</span>, <span class="st">&quot;Virginia&quot;</span>, <span class="st">&quot;Washington&quot;</span>, </span>
<span id="cb10-28"><a href="user-documentation.html#cb10-28" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;West Virginia&quot;</span>, <span class="st">&quot;Wisconsin&quot;</span>,<span class="st">&quot;Wyoming&quot;</span>, <span class="st">&quot;Puerto Rico&quot;</span>)</span>
<span id="cb10-29"><a href="user-documentation.html#cb10-29" aria-hidden="true" tabindex="-1"></a>df_states_fips <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">list</span>(<span class="at">fips =</span> fips_list,</span>
<span id="cb10-30"><a href="user-documentation.html#cb10-30" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">state =</span> state_list,</span>
<span id="cb10-31"><a href="user-documentation.html#cb10-31" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">state_full =</span> states_names_list))</span>
<span id="cb10-32"><a href="user-documentation.html#cb10-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-33"><a href="user-documentation.html#cb10-33" aria-hidden="true" tabindex="-1"></a><span class="co"># loop through state df to get all ZIP codes w/in state</span></span>
<span id="cb10-34"><a href="user-documentation.html#cb10-34" aria-hidden="true" tabindex="-1"></a>df_states_zip_codes <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb10-35"><a href="user-documentation.html#cb10-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-36"><a href="user-documentation.html#cb10-36" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(fips_list)){</span>
<span id="cb10-37"><a href="user-documentation.html#cb10-37" aria-hidden="true" tabindex="-1"></a>  state <span class="ot">&lt;-</span> zipcodeR<span class="sc">::</span><span class="fu">search_fips</span>(<span class="at">state_fips =</span> fips_list[[i]]) <span class="sc">%&gt;%</span> </span>
<span id="cb10-38"><a href="user-documentation.html#cb10-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(zipcode, state)</span>
<span id="cb10-39"><a href="user-documentation.html#cb10-39" aria-hidden="true" tabindex="-1"></a>  df_states_zip_codes <span class="ot">&lt;-</span> <span class="fu">rbind</span>(df_states_zip_codes, state)</span>
<span id="cb10-40"><a href="user-documentation.html#cb10-40" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-41"><a href="user-documentation.html#cb10-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-42"><a href="user-documentation.html#cb10-42" aria-hidden="true" tabindex="-1"></a><span class="co"># add full state name and fips code to list of all ZIP codes for each state</span></span>
<span id="cb10-43"><a href="user-documentation.html#cb10-43" aria-hidden="true" tabindex="-1"></a>df_states_fips_zip_codes <span class="ot">&lt;-</span> </span>
<span id="cb10-44"><a href="user-documentation.html#cb10-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="at">x =</span> df_states_zip_codes,</span>
<span id="cb10-45"><a href="user-documentation.html#cb10-45" aria-hidden="true" tabindex="-1"></a>            <span class="at">y =</span> df_states_fips,</span>
<span id="cb10-46"><a href="user-documentation.html#cb10-46" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="st">&quot;state&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb10-47"><a href="user-documentation.html#cb10-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>fips) <span class="sc">%&gt;%</span> </span>
<span id="cb10-48"><a href="user-documentation.html#cb10-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">customer_zip_state =</span> state,</span>
<span id="cb10-49"><a href="user-documentation.html#cb10-49" aria-hidden="true" tabindex="-1"></a>         <span class="at">customer_zip_state_full =</span> state_full,</span>
<span id="cb10-50"><a href="user-documentation.html#cb10-50" aria-hidden="true" tabindex="-1"></a>         <span class="at">zip_code =</span> zipcode)</span></code></pre></div>
</div>
<div id="u.s.-census-data" class="section level4" number="8.3.2.2">
<h4><span class="header-section-number">8.3.2.2</span> U.S. Census Data</h4>
<p>US Census data is publicly accessible in many ways. Our product utilizes the R package <code>tidycensus</code> <span class="citation">(<a href="#ref-R-tidycensus" role="doc-biblioref">Walker and Herman 2021</a>)</span> to access the necessary variables from the 2018 <a href="https://www.census.gov/programs-surveys/acs/data.html">American Community Survey (ACS)</a> via API. API access requires an api key, which can then be saved into your RStudio environment. Learn more about API keys and working with <code>tidycensus</code> <a href="https://walker-data.com/tidycensus/articles/basic-usage.html">here</a>.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="user-documentation.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># API set up</span></span>
<span id="cb11-2"><a href="user-documentation.html#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Only have to run this the first time using on a new machine</span></span>
<span id="cb11-3"><a href="user-documentation.html#cb11-3" aria-hidden="true" tabindex="-1"></a>census_api <span class="ot">&lt;-</span> <span class="fu">source</span>(<span class="st">&quot;private/census-api.R&quot;</span>)</span>
<span id="cb11-4"><a href="user-documentation.html#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="fu">census_api_key</span>(<span class="at">key =</span> census_api[[<span class="dv">1</span>]], <span class="at">install =</span> <span class="cn">TRUE</span>, <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-5"><a href="user-documentation.html#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co"># run in console:</span></span>
<span id="cb11-6"><a href="user-documentation.html#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="fu">readRenviron</span>(<span class="st">&quot;~/.Renviron&quot;</span>)</span></code></pre></div>
<p>Sample data are collected for the ACS each year and includes many variables that cover social, economic, housing, and demographic characteristics. All variable options can be easily viewed using the code below:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="user-documentation.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># look at variable options</span></span>
<span id="cb12-2"><a href="user-documentation.html#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(<span class="fu">load_variables</span>(<span class="dv">2018</span>, <span class="st">&quot;acs5&quot;</span>, <span class="at">cache =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<p>The Outdoor Equity App utilizes the <a href="https://www.census.gov/data/developers/data-sets/acs-5year.html">ACS 5-year data</a>, which is an estimate representing data collected over the designated 5 year period. We used the 5-year ACS data over the 1-year ACS data because it increases “statistical reliability of the data for less populated areas and small population subgroups” <span class="citation">(<a href="#ref-ACS" role="doc-biblioref">Bureau 2022</a>)</span>.</p>
<p>The variables included in the App include median-income, race, language(s) spoken at home, and highest level of education attained. All variables are represented as estimates in numeric format for a census tract. Data are called by geographic region, in our case the ZIP code tabulation area, and include an estimated number of people that fall into each category within each ZIP code, a margin of error, and an estimated number of total people in the area. Within our custom functions <code>function_acs_education.R</code>, <code>function_acs_language.R</code>, <code>function_acs_median_income.R</code>, and <code>function_acs_race.R</code> we first imported just the necessary columns for each ACS variable. See Table <a href="user-documentation.html#tab:acs-race-tab">8.1</a> for an example of the race variable.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="user-documentation.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># import variables for race</span></span>
<span id="cb13-2"><a href="user-documentation.html#cb13-2" aria-hidden="true" tabindex="-1"></a>race_df <span class="ot">&lt;-</span> </span>
<span id="cb13-3"><a href="user-documentation.html#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_acs</span>(</span>
<span id="cb13-4"><a href="user-documentation.html#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">geography =</span> <span class="st">&quot;zcta&quot;</span>, <span class="at">year =</span> <span class="dv">2018</span>,</span>
<span id="cb13-5"><a href="user-documentation.html#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">state =</span> <span class="st">&quot;CA&quot;</span>,</span>
<span id="cb13-6"><a href="user-documentation.html#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">summary_var =</span> <span class="st">&quot;B03002_001&quot;</span>, <span class="co">#Estimate!!Total: </span></span>
<span id="cb13-7"><a href="user-documentation.html#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">variables =</span> <span class="fu">c</span>(</span>
<span id="cb13-8"><a href="user-documentation.html#cb13-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">white =</span> <span class="st">&quot;B03002_003&quot;</span>, <span class="co">#White alone</span></span>
<span id="cb13-9"><a href="user-documentation.html#cb13-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">black =</span> <span class="st">&quot;B03002_004&quot;</span>, <span class="co">#Black or African American alone</span></span>
<span id="cb13-10"><a href="user-documentation.html#cb13-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">native_american =</span> <span class="st">&quot;B03002_005&quot;</span>, <span class="co">#American Indian and Alaska Native alone</span></span>
<span id="cb13-11"><a href="user-documentation.html#cb13-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">asian =</span> <span class="st">&quot;B03002_006&quot;</span>, <span class="co">#Asian alone</span></span>
<span id="cb13-12"><a href="user-documentation.html#cb13-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">pacific_islander =</span> <span class="st">&quot;B03002_007&quot;</span>, <span class="co">#Native Hawaiian/Other Pacific Islander alone</span></span>
<span id="cb13-13"><a href="user-documentation.html#cb13-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">other =</span> <span class="st">&quot;B03002_008&quot;</span>, <span class="co">#Some other race alone</span></span>
<span id="cb13-14"><a href="user-documentation.html#cb13-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">multiracial =</span> <span class="st">&quot;B03002_009&quot;</span>, <span class="co">#Two or more races</span></span>
<span id="cb13-15"><a href="user-documentation.html#cb13-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">hispanic_latinx =</span> <span class="st">&quot;B03002_012&quot;</span> <span class="co">#Hispanic or Latino</span></span>
<span id="cb13-16"><a href="user-documentation.html#cb13-16" aria-hidden="true" tabindex="-1"></a>    ))</span></code></pre></div>
<table>
<caption>
<span id="tab:acs-race-tab">Table 8.1: </span>Example of raw ACS Race Variable.
</caption>
<thead>
<tr>
<th style="text-align:left;">
GEOID
</th>
<th style="text-align:left;">
NAME
</th>
<th style="text-align:left;">
variable
</th>
<th style="text-align:right;">
estimate
</th>
<th style="text-align:right;">
moe
</th>
<th style="text-align:right;">
summary_est
</th>
<th style="text-align:right;">
summary_moe
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
90001
</td>
<td style="text-align:left;">
ZCTA5 90001
</td>
<td style="text-align:left;">
white
</td>
<td style="text-align:right;">
413
</td>
<td style="text-align:right;">
165
</td>
<td style="text-align:right;">
58975
</td>
<td style="text-align:right;">
1725
</td>
</tr>
<tr>
<td style="text-align:left;">
90001
</td>
<td style="text-align:left;">
ZCTA5 90001
</td>
<td style="text-align:left;">
black
</td>
<td style="text-align:right;">
5138
</td>
<td style="text-align:right;">
646
</td>
<td style="text-align:right;">
58975
</td>
<td style="text-align:right;">
1725
</td>
</tr>
<tr>
<td style="text-align:left;">
90001
</td>
<td style="text-align:left;">
ZCTA5 90001
</td>
<td style="text-align:left;">
native_american
</td>
<td style="text-align:right;">
37
</td>
<td style="text-align:right;">
42
</td>
<td style="text-align:right;">
58975
</td>
<td style="text-align:right;">
1725
</td>
</tr>
<tr>
<td style="text-align:left;">
90001
</td>
<td style="text-align:left;">
ZCTA5 90001
</td>
<td style="text-align:left;">
asian
</td>
<td style="text-align:right;">
67
</td>
<td style="text-align:right;">
38
</td>
<td style="text-align:right;">
58975
</td>
<td style="text-align:right;">
1725
</td>
</tr>
<tr>
<td style="text-align:left;">
90001
</td>
<td style="text-align:left;">
ZCTA5 90001
</td>
<td style="text-align:left;">
pacific_islander
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
29
</td>
<td style="text-align:right;">
58975
</td>
<td style="text-align:right;">
1725
</td>
</tr>
<tr>
<td style="text-align:left;">
90001
</td>
<td style="text-align:left;">
ZCTA5 90001
</td>
<td style="text-align:left;">
other
</td>
<td style="text-align:right;">
168
</td>
<td style="text-align:right;">
169
</td>
<td style="text-align:right;">
58975
</td>
<td style="text-align:right;">
1725
</td>
</tr>
<tr>
<td style="text-align:left;">
90001
</td>
<td style="text-align:left;">
ZCTA5 90001
</td>
<td style="text-align:left;">
multiracial
</td>
<td style="text-align:right;">
66
</td>
<td style="text-align:right;">
44
</td>
<td style="text-align:right;">
58975
</td>
<td style="text-align:right;">
1725
</td>
</tr>
<tr>
<td style="text-align:left;">
90001
</td>
<td style="text-align:left;">
ZCTA5 90001
</td>
<td style="text-align:left;">
hispanic_latinx
</td>
<td style="text-align:right;">
53086
</td>
<td style="text-align:right;">
1591
</td>
<td style="text-align:right;">
58975
</td>
<td style="text-align:right;">
1725
</td>
</tr>
<tr>
<td style="text-align:left;">
90002
</td>
<td style="text-align:left;">
ZCTA5 90002
</td>
<td style="text-align:left;">
white
</td>
<td style="text-align:right;">
223
</td>
<td style="text-align:right;">
81
</td>
<td style="text-align:right;">
53111
</td>
<td style="text-align:right;">
2031
</td>
</tr>
<tr>
<td style="text-align:left;">
90002
</td>
<td style="text-align:left;">
ZCTA5 90002
</td>
<td style="text-align:left;">
black
</td>
<td style="text-align:right;">
10110
</td>
<td style="text-align:right;">
876
</td>
<td style="text-align:right;">
53111
</td>
<td style="text-align:right;">
2031
</td>
</tr>
</tbody>
</table>
<p>We calculated percentages for the categories within each ACS variable for race, language(s) spoken in the home, and highest level of education by dividing the estimate for a category by the estimated total population for that ZIP code.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="user-documentation.html#cb14-1" aria-hidden="true" tabindex="-1"></a>race_df_percent <span class="ot">&lt;-</span> </span>
<span id="cb14-2"><a href="user-documentation.html#cb14-2" aria-hidden="true" tabindex="-1"></a>  race_df <span class="sc">%&gt;%</span> </span>
<span id="cb14-3"><a href="user-documentation.html#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(zip_code, race) <span class="sc">%&gt;%</span> </span>
<span id="cb14-4"><a href="user-documentation.html#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">estimate =</span> <span class="fu">sum</span>(estimate),</span>
<span id="cb14-5"><a href="user-documentation.html#cb14-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">moe =</span> <span class="fu">sum</span>(moe),</span>
<span id="cb14-6"><a href="user-documentation.html#cb14-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">summary_est =</span> <span class="fu">unique</span>(summary_est),</span>
<span id="cb14-7"><a href="user-documentation.html#cb14-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">summary_moe =</span> <span class="fu">unique</span>(summary_moe),</span>
<span id="cb14-8"><a href="user-documentation.html#cb14-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">percent =</span> estimate <span class="sc">/</span> summary_est)</span></code></pre></div>
<p>For median-income, we use the estimated median-income as is, without further adjustments.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="user-documentation.html#cb15-1" aria-hidden="true" tabindex="-1"></a>median_income_df <span class="ot">&lt;-</span> </span>
<span id="cb15-2"><a href="user-documentation.html#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_acs</span>(<span class="at">geography =</span> <span class="st">&quot;zcta&quot;</span>, <span class="at">year =</span> <span class="dv">2018</span>,</span>
<span id="cb15-3"><a href="user-documentation.html#cb15-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">state =</span> <span class="st">&quot;CA&quot;</span>,</span>
<span id="cb15-4"><a href="user-documentation.html#cb15-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">variables =</span> <span class="fu">c</span>(</span>
<span id="cb15-5"><a href="user-documentation.html#cb15-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">median_income =</span> <span class="st">&quot;B19013_001&quot;</span> </span>
<span id="cb15-6"><a href="user-documentation.html#cb15-6" aria-hidden="true" tabindex="-1"></a>          )) <span class="sc">%&gt;%</span> </span>
<span id="cb15-7"><a href="user-documentation.html#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb15-8"><a href="user-documentation.html#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">median_income =</span> estimate) <span class="sc">%&gt;%</span> </span>
<span id="cb15-9"><a href="user-documentation.html#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">zip_code =</span> <span class="fu">str_sub</span>(name, <span class="at">start =</span> <span class="sc">-</span><span class="dv">5</span>, <span class="at">end =</span> <span class="sc">-</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-10"><a href="user-documentation.html#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(median_income, zip_code)</span></code></pre></div>
<p>We transform teh ACS dataframe by pivoting wider, which moves the different categories and percentages (ex: racial groups) to their own columns to create a single row for each ZIP code. This is necessary for joining the ACS data sets to the RIDS data set.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="user-documentation.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(zip_code, summary_est, race, percent) <span class="sc">%&gt;%</span> </span>
<span id="cb16-2"><a href="user-documentation.html#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">zip_code_population =</span> summary_est) <span class="sc">%&gt;%</span> </span>
<span id="cb16-3"><a href="user-documentation.html#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create column for each percentage for each group (pivot_wider)</span></span>
<span id="cb16-4"><a href="user-documentation.html#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># necessary to be able to left_join() with RIDB data</span></span>
<span id="cb16-5"><a href="user-documentation.html#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">&quot;race&quot;</span>,</span>
<span id="cb16-6"><a href="user-documentation.html#cb16-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> <span class="st">&quot;percent&quot;</span>)</span></code></pre></div>
<p>Finally, we use the <code>function_join_ridb_acs.R</code> custom functions to join the RIDB and ACS data to create the dataset that is available for download on the App and utilized for all plots and maps.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="user-documentation.html#cb17-1" aria-hidden="true" tabindex="-1"></a>joined_df <span class="ot">&lt;-</span> </span>
<span id="cb17-2"><a href="user-documentation.html#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="at">x =</span> ridb_df,</span>
<span id="cb17-3"><a href="user-documentation.html#cb17-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">y =</span> acs_df_race,</span>
<span id="cb17-4"><a href="user-documentation.html#cb17-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;customer_zip&quot;</span> <span class="ot">=</span> <span class="st">&quot;zip_code&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb17-5"><a href="user-documentation.html#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="at">y =</span> acs_df_education,</span>
<span id="cb17-6"><a href="user-documentation.html#cb17-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;customer_zip&quot;</span> <span class="ot">=</span> <span class="st">&quot;zip_code&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb17-7"><a href="user-documentation.html#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="at">y =</span> acs_df_median_income,</span>
<span id="cb17-8"><a href="user-documentation.html#cb17-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;customer_zip&quot;</span> <span class="ot">=</span> <span class="st">&quot;zip_code&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb17-9"><a href="user-documentation.html#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="at">y =</span> acs_df_language,</span>
<span id="cb17-10"><a href="user-documentation.html#cb17-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;customer_zip&quot;</span> <span class="ot">=</span> <span class="st">&quot;zip_code&quot;</span>))</span></code></pre></div>
</div>
</div>
<div id="statistical-analysis-and-data-wrangling-for-plots" class="section level3" number="8.3.3">
<h3><span class="header-section-number">8.3.3</span> Statistical Analysis and Data Wrangling for Plots</h3>
<p>Each type of plot and map require unique data wrangling which is explained in this section.</p>
<div id="data-summary" class="section level4" number="8.3.3.1">
<h4><span class="header-section-number">8.3.3.1</span> Data Summary</h4>
<p>We created custom functions for data wrangling and plotting for use within the Outdoor Equity App code. Wrangling begins with filtering based on the user’s choice campsite input. We then further subset the dataset to include only the necessary columns for plotting.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="user-documentation.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># example for booking window data summary</span></span>
<span id="cb18-2"><a href="user-documentation.html#cb18-2" aria-hidden="true" tabindex="-1"></a>booking_window_rdf <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb18-3"><a href="user-documentation.html#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">validate</span>(</span>
<span id="cb18-4"><a href="user-documentation.html#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">need</span>(siteInput <span class="sc">!=</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb18-5"><a href="user-documentation.html#cb18-5" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;Please select a reservable site to visualize.&quot;</span>)</span>
<span id="cb18-6"><a href="user-documentation.html#cb18-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="co"># EO validate</span></span>
<span id="cb18-7"><a href="user-documentation.html#cb18-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-8"><a href="user-documentation.html#cb18-8" aria-hidden="true" tabindex="-1"></a>  ridb_df <span class="sc">%&gt;%</span></span>
<span id="cb18-9"><a href="user-documentation.html#cb18-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(park <span class="sc">%in%</span> siteInput,</span>
<span id="cb18-10"><a href="user-documentation.html#cb18-10" aria-hidden="true" tabindex="-1"></a>           booking_window <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb18-11"><a href="user-documentation.html#cb18-11" aria-hidden="true" tabindex="-1"></a>           booking_window <span class="sc">!=</span> <span class="st">&quot;Inf&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb18-12"><a href="user-documentation.html#cb18-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(park, booking_window) <span class="sc">%&gt;%</span> </span>
<span id="cb18-13"><a href="user-documentation.html#cb18-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(booking_window))</span>
<span id="cb18-14"><a href="user-documentation.html#cb18-14" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p>We create histograms, bar charts, or density plots to show the distribution of the data for each variable. For ACS variables, data from reservations are plotted against data for the full California population. This allows a user to compare the distribution within the reservation data to that of the California census in order to see where reservations either under- or over-represent that variable as compared to California residents. We used the <code>plotly</code> package <span class="citation">(<a href="#ref-R-plotly" role="doc-biblioref">Sievert et al. 2021</a>)</span> to allow a user to hover over the plot to view helper text. We also included additional helper text outside of the plots for more complicated plots.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="user-documentation.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="do">## -- example for booking window data summary -- ##</span></span>
<span id="cb19-2"><a href="user-documentation.html#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co"># parameters</span></span>
<span id="cb19-3"><a href="user-documentation.html#cb19-3" aria-hidden="true" tabindex="-1"></a>hist_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;#64863C&quot;</span>, <span class="st">&quot;#466C04&quot;</span>)</span>
<span id="cb19-4"><a href="user-documentation.html#cb19-4" aria-hidden="true" tabindex="-1"></a>quant_80_color <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;#FACE00&quot;</span>)</span>
<span id="cb19-5"><a href="user-documentation.html#cb19-5" aria-hidden="true" tabindex="-1"></a>caption_color <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;#ac8d00&quot;</span>)</span>
<span id="cb19-6"><a href="user-documentation.html#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="user-documentation.html#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co"># plot for shiny app</span></span>
<span id="cb19-8"><a href="user-documentation.html#cb19-8" aria-hidden="true" tabindex="-1"></a>plotly <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb19-9"><a href="user-documentation.html#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">booking_window_rdf</span>()) <span class="sc">+</span></span>
<span id="cb19-10"><a href="user-documentation.html#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(</span>
<span id="cb19-11"><a href="user-documentation.html#cb19-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> booking_window,</span>
<span id="cb19-12"><a href="user-documentation.html#cb19-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">text =</span> <span class="fu">paste0</span>(<span class="fu">percent</span>(..count.. <span class="sc">/</span> <span class="fu">nrow</span>(<span class="fu">booking_window_rdf</span>()), </span>
<span id="cb19-13"><a href="user-documentation.html#cb19-13" aria-hidden="true" tabindex="-1"></a>                              <span class="at">accuracy =</span> <span class="fl">0.1</span>), </span>
<span id="cb19-14"><a href="user-documentation.html#cb19-14" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&quot; of all visits are reserved between &quot;</span>, xmin, </span>
<span id="cb19-15"><a href="user-documentation.html#cb19-15" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&quot; and &quot;</span>, xmax, </span>
<span id="cb19-16"><a href="user-documentation.html#cb19-16" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&quot; days before the start of the visit&quot;</span>, </span>
<span id="cb19-17"><a href="user-documentation.html#cb19-17" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&quot;&lt;br&gt;&quot;</span>,</span>
<span id="cb19-18"><a href="user-documentation.html#cb19-18" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&quot;(Total reservations to site: &quot;</span>,</span>
<span id="cb19-19"><a href="user-documentation.html#cb19-19" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">comma</span>(<span class="fu">nrow</span>(<span class="fu">booking_window_rdf</span>()), <span class="at">accuracy =</span> <span class="dv">1</span>), </span>
<span id="cb19-20"><a href="user-documentation.html#cb19-20" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&quot;)&quot;</span>)),</span>
<span id="cb19-21"><a href="user-documentation.html#cb19-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">binwidth =</span> <span class="dv">7</span>,</span>
<span id="cb19-22"><a href="user-documentation.html#cb19-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">center =</span> <span class="dv">7</span> <span class="sc">/</span> <span class="dv">2</span>,</span>
<span id="cb19-23"><a href="user-documentation.html#cb19-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> hist_colors[[<span class="dv">1</span>]], </span>
<span id="cb19-24"><a href="user-documentation.html#cb19-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> hist_colors[[<span class="dv">2</span>]], <span class="at">size =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb19-25"><a href="user-documentation.html#cb19-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Days in advance before visit (each bar = 1 week)&quot;</span>,</span>
<span id="cb19-26"><a href="user-documentation.html#cb19-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb19-27"><a href="user-documentation.html#cb19-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, x_max)) <span class="sc">+</span></span>
<span id="cb19-28"><a href="user-documentation.html#cb19-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> quant_80,</span>
<span id="cb19-29"><a href="user-documentation.html#cb19-29" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">color =</span> quant_80_color) <span class="sc">+</span></span>
<span id="cb19-30"><a href="user-documentation.html#cb19-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb19-31"><a href="user-documentation.html#cb19-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="st">&quot;white&quot;</span>),</span>
<span id="cb19-32"><a href="user-documentation.html#cb19-32" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>())</span>
<span id="cb19-33"><a href="user-documentation.html#cb19-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-34"><a href="user-documentation.html#cb19-34" aria-hidden="true" tabindex="-1"></a><span class="co"># add 6 month / 1 year annotation if data allows</span></span>
<span id="cb19-35"><a href="user-documentation.html#cb19-35" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (x_max <span class="sc">&lt;=</span> <span class="dv">180</span>) {</span>
<span id="cb19-36"><a href="user-documentation.html#cb19-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># don&#39;t include 6 month or 1 year annotation</span></span>
<span id="cb19-37"><a href="user-documentation.html#cb19-37" aria-hidden="true" tabindex="-1"></a>  plotly</span>
<span id="cb19-38"><a href="user-documentation.html#cb19-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-39"><a href="user-documentation.html#cb19-39" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span> (x_max <span class="sc">&gt;</span> <span class="dv">180</span> <span class="sc">&amp;</span> x_max <span class="sc">&lt;=</span> <span class="dv">360</span>){</span>
<span id="cb19-40"><a href="user-documentation.html#cb19-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># include 6 month annotation</span></span>
<span id="cb19-41"><a href="user-documentation.html#cb19-41" aria-hidden="true" tabindex="-1"></a>  plotly <span class="ot">&lt;-</span> plotly <span class="sc">+</span></span>
<span id="cb19-42"><a href="user-documentation.html#cb19-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">180</span>, </span>
<span id="cb19-43"><a href="user-documentation.html#cb19-43" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">size =</span> .<span class="dv">3</span>, <span class="at">alpha =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb19-44"><a href="user-documentation.html#cb19-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">label =</span> <span class="st">&quot;6 months&quot;</span>,  <span class="at">size =</span> <span class="dv">3</span>,</span>
<span id="cb19-45"><a href="user-documentation.html#cb19-45" aria-hidden="true" tabindex="-1"></a>             <span class="at">x =</span> <span class="dv">180</span>, <span class="at">y =</span> <span class="dv">5</span>)</span>
<span id="cb19-46"><a href="user-documentation.html#cb19-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-47"><a href="user-documentation.html#cb19-47" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span> (x_max <span class="sc">&gt;=</span> <span class="dv">360</span>) {</span>
<span id="cb19-48"><a href="user-documentation.html#cb19-48" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-49"><a href="user-documentation.html#cb19-49" aria-hidden="true" tabindex="-1"></a>  <span class="co"># include 6 month and 1 year annotation</span></span>
<span id="cb19-50"><a href="user-documentation.html#cb19-50" aria-hidden="true" tabindex="-1"></a>  plotly <span class="ot">&lt;-</span> plotly <span class="sc">+</span></span>
<span id="cb19-51"><a href="user-documentation.html#cb19-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">180</span>, </span>
<span id="cb19-52"><a href="user-documentation.html#cb19-52" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">size =</span> .<span class="dv">3</span>, <span class="at">alpha =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb19-53"><a href="user-documentation.html#cb19-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">label =</span> <span class="st">&quot;6 months&quot;</span>, <span class="at">size =</span> <span class="dv">3</span>,</span>
<span id="cb19-54"><a href="user-documentation.html#cb19-54" aria-hidden="true" tabindex="-1"></a>             <span class="at">x =</span> <span class="dv">180</span>, <span class="at">y =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb19-55"><a href="user-documentation.html#cb19-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">360</span>,</span>
<span id="cb19-56"><a href="user-documentation.html#cb19-56" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">size =</span> .<span class="dv">3</span>, <span class="at">alpha =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb19-57"><a href="user-documentation.html#cb19-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">label =</span> <span class="st">&quot;1 year&quot;</span>, <span class="at">size =</span> <span class="dv">3</span>,</span>
<span id="cb19-58"><a href="user-documentation.html#cb19-58" aria-hidden="true" tabindex="-1"></a>             <span class="at">x =</span> <span class="dv">360</span>, <span class="at">y =</span> <span class="dv">5</span>)</span>
<span id="cb19-59"><a href="user-documentation.html#cb19-59" aria-hidden="true" tabindex="-1"></a>} <span class="co"># EO else if for plotly</span></span>
<span id="cb19-60"><a href="user-documentation.html#cb19-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-61"><a href="user-documentation.html#cb19-61" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplotly</span>(plotly,</span>
<span id="cb19-62"><a href="user-documentation.html#cb19-62" aria-hidden="true" tabindex="-1"></a>         <span class="at">tooltip =</span> <span class="fu">list</span>(<span class="st">&quot;text&quot;</span>),</span>
<span id="cb19-63"><a href="user-documentation.html#cb19-63" aria-hidden="true" tabindex="-1"></a>         <span class="at">dynamicTicks =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb19-64"><a href="user-documentation.html#cb19-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(<span class="at">title =</span> </span>
<span id="cb19-65"><a href="user-documentation.html#cb19-65" aria-hidden="true" tabindex="-1"></a>           <span class="fu">list</span>(<span class="at">text =</span> </span>
<span id="cb19-66"><a href="user-documentation.html#cb19-66" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">paste0</span>(<span class="st">&#39;&lt;b&gt;&#39;</span>, siteInput, <span class="st">&#39;&lt;br&gt;&#39;</span>, admin_unitInput, <span class="st">&#39;&lt;/b&gt;&#39;</span>,</span>
<span id="cb19-67"><a href="user-documentation.html#cb19-67" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&#39;&lt;br&gt;&#39;</span>,</span>
<span id="cb19-68"><a href="user-documentation.html#cb19-68" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&#39;Number of days from reservation to start of visit&#39;</span>),</span>
<span id="cb19-69"><a href="user-documentation.html#cb19-69" aria-hidden="true" tabindex="-1"></a>                <span class="at">font =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">15</span>)),</span>
<span id="cb19-70"><a href="user-documentation.html#cb19-70" aria-hidden="true" tabindex="-1"></a>         <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">separatethousands =</span> <span class="cn">TRUE</span>),</span>
<span id="cb19-71"><a href="user-documentation.html#cb19-71" aria-hidden="true" tabindex="-1"></a>         <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">separatethousands =</span> <span class="cn">TRUE</span>),</span>
<span id="cb19-72"><a href="user-documentation.html#cb19-72" aria-hidden="true" tabindex="-1"></a>         <span class="at">margin =</span> <span class="fu">list</span>(<span class="at">b =</span> <span class="dv">130</span>, <span class="at">t =</span> <span class="dv">100</span>), </span>
<span id="cb19-73"><a href="user-documentation.html#cb19-73" aria-hidden="true" tabindex="-1"></a>         <span class="at">annotations =</span>  </span>
<span id="cb19-74"><a href="user-documentation.html#cb19-74" aria-hidden="true" tabindex="-1"></a>           <span class="fu">list</span>(<span class="at">x =</span> x_max<span class="sc">/</span><span class="dv">2</span>, <span class="at">y =</span> <span class="sc">-</span><span class="fl">0.6</span>, </span>
<span id="cb19-75"><a href="user-documentation.html#cb19-75" aria-hidden="true" tabindex="-1"></a>                <span class="at">text =</span> </span>
<span id="cb19-76"><a href="user-documentation.html#cb19-76" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">paste0</span>(<span class="st">&quot;80% of reservations reserve their visit less than &quot;</span>, </span>
<span id="cb19-77"><a href="user-documentation.html#cb19-77" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&#39;&lt;b&gt;&#39;</span>, quant_80, <span class="st">&#39;&lt;/b&gt;&#39;</span>, </span>
<span id="cb19-78"><a href="user-documentation.html#cb19-78" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot; days before the start date&quot;</span>, </span>
<span id="cb19-79"><a href="user-documentation.html#cb19-79" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;&lt;br&gt;&quot;</span>,</span>
<span id="cb19-80"><a href="user-documentation.html#cb19-80" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;(shown on plot with yellow dotted line).&quot;</span>), </span>
<span id="cb19-81"><a href="user-documentation.html#cb19-81" aria-hidden="true" tabindex="-1"></a>                <span class="at">showarrow =</span> F, </span>
<span id="cb19-82"><a href="user-documentation.html#cb19-82" aria-hidden="true" tabindex="-1"></a>                <span class="at">xre =</span> <span class="st">&#39;paper&#39;</span>, <span class="at">yref =</span> <span class="st">&#39;paper&#39;</span>, </span>
<span id="cb19-83"><a href="user-documentation.html#cb19-83" aria-hidden="true" tabindex="-1"></a>                             <span class="at">xanchor =</span> <span class="st">&#39;middle&#39;</span>, <span class="at">yanchor =</span> <span class="st">&#39;auto&#39;</span>, </span>
<span id="cb19-84"><a href="user-documentation.html#cb19-84" aria-hidden="true" tabindex="-1"></a>                             <span class="at">xshift =</span> <span class="dv">0</span>, <span class="at">yshift =</span> <span class="dv">0</span>,</span>
<span id="cb19-85"><a href="user-documentation.html#cb19-85" aria-hidden="true" tabindex="-1"></a>                             <span class="at">font =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">color =</span> caption_color))) <span class="sc">%&gt;%</span></span>
<span id="cb19-86"><a href="user-documentation.html#cb19-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">config</span>(<span class="at">modeBarButtonsToRemove =</span> <span class="fu">list</span>(<span class="st">&quot;pan&quot;</span>, <span class="st">&quot;select&quot;</span>, <span class="st">&quot;lasso2d&quot;</span>, <span class="st">&quot;autoScale2d&quot;</span>, </span>
<span id="cb19-87"><a href="user-documentation.html#cb19-87" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">&quot;hoverClosestCartesian&quot;</span>, </span>
<span id="cb19-88"><a href="user-documentation.html#cb19-88" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">&quot;hoverCompareCartesian&quot;</span>))</span></code></pre></div>
</div>
<div id="data-relationships" class="section level4" number="8.3.3.2">
<h4><span class="header-section-number">8.3.3.2</span> Data Relationships</h4>
<p>Visualizing the relationship between RIDB and ACS variables is challenging because the socioeconomic data available are an estimate of the ZIP code population, rather than data of the individual making the reservation. In order to create simple, easy to interpret plots, we determined whether reservations were from a location with “high” percentages of a given ACS variable category (ex: one of the eight racial groups). We determined “high” as anything above the weighted 3rd quartile (weighted based on the California census). This method allows for reservations to be included in the “high” category for multiple values within one ACS variable (ex: a reservation might be from a ZIP code that falls into the “high” category for both Black and Asian folks). By allowing a reservation to appear in multiple categories within a single ACS variable, the uncertainty of the reserver’s actual socioeconomic status is retained.</p>
<p>Example code for calculating the “high” threshold for language can be seen below:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="user-documentation.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># `function_acs_top_quartile_language.R` code</span></span>
<span id="cb20-2"><a href="user-documentation.html#cb20-2" aria-hidden="true" tabindex="-1"></a>threshold_df <span class="ot">&lt;-</span> acs_df <span class="sc">%&gt;%</span></span>
<span id="cb20-3"><a href="user-documentation.html#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter variables of interest</span></span>
<span id="cb20-4"><a href="user-documentation.html#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(zip_code, english_only, not_english_only, mean_zip_code_population) <span class="sc">%&gt;%</span> </span>
<span id="cb20-5"><a href="user-documentation.html#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="cb20-6"><a href="user-documentation.html#cb20-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;language&quot;</span>,</span>
<span id="cb20-7"><a href="user-documentation.html#cb20-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;language_percentage&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb20-8"><a href="user-documentation.html#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter category of interest</span></span>
<span id="cb20-9"><a href="user-documentation.html#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(language <span class="sc">==</span> language_group) <span class="sc">%&gt;%</span> </span>
<span id="cb20-10"><a href="user-documentation.html#cb20-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(language_percentage)</span>
<span id="cb20-11"><a href="user-documentation.html#cb20-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-12"><a href="user-documentation.html#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="co"># weighted median value (weighted based on ZIP code populations)</span></span>
<span id="cb20-13"><a href="user-documentation.html#cb20-13" aria-hidden="true" tabindex="-1"></a>weighted_half <span class="ot">&lt;-</span> <span class="fu">weighted.mean</span>(<span class="at">x =</span> threshold_df<span class="sc">$</span>language_percentage, </span>
<span id="cb20-14"><a href="user-documentation.html#cb20-14" aria-hidden="true" tabindex="-1"></a>                               <span class="at">w =</span> threshold_df<span class="sc">$</span>mean_zip_code_population)</span>
<span id="cb20-15"><a href="user-documentation.html#cb20-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-16"><a href="user-documentation.html#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="co"># drop rows below weighted median</span></span>
<span id="cb20-17"><a href="user-documentation.html#cb20-17" aria-hidden="true" tabindex="-1"></a>df_half <span class="ot">&lt;-</span> threshold_df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(language_percentage <span class="sc">&gt;=</span> weighted_half)</span>
<span id="cb20-18"><a href="user-documentation.html#cb20-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-19"><a href="user-documentation.html#cb20-19" aria-hidden="true" tabindex="-1"></a><span class="co"># weighted 3rd quartile</span></span>
<span id="cb20-20"><a href="user-documentation.html#cb20-20" aria-hidden="true" tabindex="-1"></a><span class="do">## weighted median value of top half (weighted based on ZIP code populations)</span></span>
<span id="cb20-21"><a href="user-documentation.html#cb20-21" aria-hidden="true" tabindex="-1"></a>weighted_quartile <span class="ot">&lt;-</span> <span class="fu">weighted.mean</span>(<span class="at">x =</span> df_half<span class="sc">$</span>language_percentage, </span>
<span id="cb20-22"><a href="user-documentation.html#cb20-22" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">w =</span> df_half<span class="sc">$</span>mean_zip_code_population)</span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="user-documentation.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;r/function_acs_top_quartile_language.R&quot;</span>)</span>
<span id="cb21-2"><a href="user-documentation.html#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="user-documentation.html#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co"># language groups</span></span>
<span id="cb21-4"><a href="user-documentation.html#cb21-4" aria-hidden="true" tabindex="-1"></a>language_group <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;english_only&quot;</span>, <span class="st">&quot;not_english_only&quot;</span>)</span>
<span id="cb21-5"><a href="user-documentation.html#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="user-documentation.html#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate value of 3rd quartile for each language group</span></span>
<span id="cb21-7"><a href="user-documentation.html#cb21-7" aria-hidden="true" tabindex="-1"></a>language_quants_df <span class="ot">&lt;-</span></span>
<span id="cb21-8"><a href="user-documentation.html#cb21-8" aria-hidden="true" tabindex="-1"></a>  language_group <span class="sc">%&gt;%</span></span>
<span id="cb21-9"><a href="user-documentation.html#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dbl</span>(language_top_quartile, <span class="at">acs_df =</span> data_acs_ca_all) <span class="sc">%&gt;%</span></span>
<span id="cb21-10"><a href="user-documentation.html#cb21-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(<span class="st">&quot;language_group&quot;</span> <span class="ot">=</span> language_group,</span>
<span id="cb21-11"><a href="user-documentation.html#cb21-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;weighted_quartile&quot;</span> <span class="ot">=</span> .) <span class="sc">%&gt;%</span></span>
<span id="cb21-12"><a href="user-documentation.html#cb21-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb21-13"><a href="user-documentation.html#cb21-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">language_group =</span> <span class="fu">str_replace_all</span>(<span class="at">string =</span> language_group,</span>
<span id="cb21-14"><a href="user-documentation.html#cb21-14" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">pattern =</span> <span class="st">&quot;_&quot;</span>,</span>
<span id="cb21-15"><a href="user-documentation.html#cb21-15" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">replacement =</span> <span class="st">&quot; &quot;</span>),</span>
<span id="cb21-16"><a href="user-documentation.html#cb21-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">language_group =</span> <span class="fu">str_to_title</span>(language_group),</span>
<span id="cb21-17"><a href="user-documentation.html#cb21-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">weighted_quartile =</span> <span class="fu">percent</span>(<span class="fu">as.numeric</span>(weighted_quartile), </span>
<span id="cb21-18"><a href="user-documentation.html#cb21-18" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">accuracy =</span> <span class="fl">0.01</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb21-19"><a href="user-documentation.html#cb21-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">&quot;Language Group&quot;</span> <span class="ot">=</span> language_group,</span>
<span id="cb21-20"><a href="user-documentation.html#cb21-20" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;Threshold&quot;</span> <span class="ot">=</span> weighted_quartile)</span></code></pre></div>
<p>The thresholds used within the Outdoor Equity App can be seen in Table <a href="user-documentation.html#tab:thres-tab1">8.2</a> and Table <a href="user-documentation.html#tab:thres-tab2">8.3</a>.</p>
<table class="kable_wrapper">
<caption>
<span id="tab:thres-tab1">Table 8.2: </span>Threshold values for ACS language and education variables.
</caption>
<tbody>
<tr>
<td>
<table>
<thead>
<tr>
<th style="text-align:left;">
Language Group
</th>
<th style="text-align:left;">
Threshold
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
English Only
</td>
<td style="text-align:left;">
72.98%
</td>
</tr>
<tr>
<td style="text-align:left;">
Not English Only
</td>
<td style="text-align:left;">
62.75%
</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr>
<th style="text-align:left;">
Education Group
</th>
<th style="text-align:left;">
Threshold
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Hs Ged Or Below
</td>
<td style="text-align:left;">
54.21%
</td>
</tr>
<tr>
<td style="text-align:left;">
Some College
</td>
<td style="text-align:left;">
25.62%
</td>
</tr>
<tr>
<td style="text-align:left;">
College
</td>
<td style="text-align:left;">
36.85%
</td>
</tr>
<tr>
<td style="text-align:left;">
Master Or Above
</td>
<td style="text-align:left;">
22.02%
</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:thres-tab2">Table 8.3: </span>Threshold values for ACS race variable.
</caption>
<thead>
<tr>
<th style="text-align:left;">
Race Group
</th>
<th style="text-align:left;">
Threshold
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Other
</td>
<td style="text-align:left;">
0.52%
</td>
</tr>
<tr>
<td style="text-align:left;">
Pacific Islander
</td>
<td style="text-align:left;">
0.87%
</td>
</tr>
<tr>
<td style="text-align:left;">
Multiracial
</td>
<td style="text-align:left;">
4.38%
</td>
</tr>
<tr>
<td style="text-align:left;">
Asian
</td>
<td style="text-align:left;">
30.29%
</td>
</tr>
<tr>
<td style="text-align:left;">
Black
</td>
<td style="text-align:left;">
13.16%
</td>
</tr>
<tr>
<td style="text-align:left;">
White
</td>
<td style="text-align:left;">
59.08%
</td>
</tr>
<tr>
<td style="text-align:left;">
Native American
</td>
<td style="text-align:left;">
0.93%
</td>
</tr>
<tr>
<td style="text-align:left;">
Hispanic Latinx
</td>
<td style="text-align:left;">
62.07%
</td>
</tr>
</tbody>
</table>
<p>We create lollipop and bar plots to show the relationships of the data for each set of variables. We used the <code>plotly</code> package <span class="citation">(<a href="#ref-R-plotly" role="doc-biblioref">Sievert et al. 2021</a>)</span> to allow a user to hover over the plot to view helper text. An example of the code used to create the education compared to booking window plot is show below:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="user-documentation.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="do">## -- data wrangle -- ##s</span></span>
<span id="cb22-2"><a href="user-documentation.html#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># create reactive dataframe and further subset</span></span>
<span id="cb22-3"><a href="user-documentation.html#cb22-3" aria-hidden="true" tabindex="-1"></a>rdf <span class="ot">&lt;-</span> <span class="fu">reactive</span> ({</span>
<span id="cb22-4"><a href="user-documentation.html#cb22-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-5"><a href="user-documentation.html#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">validate</span>(</span>
<span id="cb22-6"><a href="user-documentation.html#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">need</span>(siteInput <span class="sc">!=</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb22-7"><a href="user-documentation.html#cb22-7" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;Please select a reservable site to visualize.&quot;</span>)</span>
<span id="cb22-8"><a href="user-documentation.html#cb22-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="co"># EO validate</span></span>
<span id="cb22-9"><a href="user-documentation.html#cb22-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-10"><a href="user-documentation.html#cb22-10" aria-hidden="true" tabindex="-1"></a>  education_top_quartile_df <span class="sc">%&gt;%</span></span>
<span id="cb22-11"><a href="user-documentation.html#cb22-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># filter to user site of choice</span></span>
<span id="cb22-12"><a href="user-documentation.html#cb22-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(park <span class="sc">==</span> siteInput) <span class="sc">%&gt;%</span></span>
<span id="cb22-13"><a href="user-documentation.html#cb22-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># select to variables of interest</span></span>
<span id="cb22-14"><a href="user-documentation.html#cb22-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(park, customer_zip, </span>
<span id="cb22-15"><a href="user-documentation.html#cb22-15" aria-hidden="true" tabindex="-1"></a>           education, education_percentage, education_y_lab, </span>
<span id="cb22-16"><a href="user-documentation.html#cb22-16" aria-hidden="true" tabindex="-1"></a>           booking_window) <span class="sc">%&gt;%</span> </span>
<span id="cb22-17"><a href="user-documentation.html#cb22-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drop_na</span>(booking_window, education_percentage) <span class="sc">%&gt;%</span> </span>
<span id="cb22-18"><a href="user-documentation.html#cb22-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(booking_window <span class="sc">&gt;=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb22-19"><a href="user-documentation.html#cb22-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># summarize to inner quartile range, median, and total reservations</span></span>
<span id="cb22-20"><a href="user-documentation.html#cb22-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(education, education_y_lab) <span class="sc">%&gt;%</span> </span>
<span id="cb22-21"><a href="user-documentation.html#cb22-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">median_booking_window =</span> <span class="fu">median</span>(booking_window),</span>
<span id="cb22-22"><a href="user-documentation.html#cb22-22" aria-hidden="true" tabindex="-1"></a>              <span class="at">quartile_lower =</span> <span class="fu">quantile</span>(booking_window)[[<span class="dv">2</span>]],</span>
<span id="cb22-23"><a href="user-documentation.html#cb22-23" aria-hidden="true" tabindex="-1"></a>              <span class="at">quartile_upper =</span> <span class="fu">quantile</span>(booking_window)[[<span class="dv">4</span>]],</span>
<span id="cb22-24"><a href="user-documentation.html#cb22-24" aria-hidden="true" tabindex="-1"></a>              <span class="at">count =</span> <span class="fu">n</span>())</span>
<span id="cb22-25"><a href="user-documentation.html#cb22-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-26"><a href="user-documentation.html#cb22-26" aria-hidden="true" tabindex="-1"></a>}) <span class="co">#EO reactive df</span></span>
<span id="cb22-27"><a href="user-documentation.html#cb22-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-28"><a href="user-documentation.html#cb22-28" aria-hidden="true" tabindex="-1"></a><span class="fu">validate</span>(<span class="fu">need</span>(</span>
<span id="cb22-29"><a href="user-documentation.html#cb22-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>(<span class="fu">rdf</span>()) <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb22-30"><a href="user-documentation.html#cb22-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(<span class="st">&quot;There are no reservations to &quot;</span>, siteInput, <span class="st">&quot;, &quot;</span>, admin_unitInput, </span>
<span id="cb22-31"><a href="user-documentation.html#cb22-31" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot; that come from communities in the high range for any educational&quot;</span>, </span>
<span id="cb22-32"><a href="user-documentation.html#cb22-32" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;categories.&quot;</span>)</span>
<span id="cb22-33"><a href="user-documentation.html#cb22-33" aria-hidden="true" tabindex="-1"></a>)) <span class="co"># EO validate</span></span>
<span id="cb22-34"><a href="user-documentation.html#cb22-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-35"><a href="user-documentation.html#cb22-35" aria-hidden="true" tabindex="-1"></a><span class="do">## -- create plot -- ##</span></span>
<span id="cb22-36"><a href="user-documentation.html#cb22-36" aria-hidden="true" tabindex="-1"></a><span class="co"># parameters</span></span>
<span id="cb22-37"><a href="user-documentation.html#cb22-37" aria-hidden="true" tabindex="-1"></a>education_group_colors <span class="ot">&lt;-</span></span>
<span id="cb22-38"><a href="user-documentation.html#cb22-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(</span>
<span id="cb22-39"><a href="user-documentation.html#cb22-39" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;HS, GED,</span><span class="sc">\n</span><span class="st">or Below&quot;</span> <span class="ot">=</span> <span class="st">&quot;#a6cee3&quot;</span>,</span>
<span id="cb22-40"><a href="user-documentation.html#cb22-40" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Some College or</span><span class="sc">\n</span><span class="st">Trade School&quot;</span>  <span class="ot">=</span> <span class="st">&quot;#1f78b4&quot;</span>,</span>
<span id="cb22-41"><a href="user-documentation.html#cb22-41" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Associates or</span><span class="sc">\n</span><span class="st">Bachelors Degree&quot;</span> <span class="ot">=</span> <span class="st">&quot;#b2df8a&quot;</span>,</span>
<span id="cb22-42"><a href="user-documentation.html#cb22-42" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Masters Degree</span><span class="sc">\n</span><span class="st">or Above&quot;</span> <span class="ot">=</span> <span class="st">&quot;#33a02c&quot;</span></span>
<span id="cb22-43"><a href="user-documentation.html#cb22-43" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb22-44"><a href="user-documentation.html#cb22-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-45"><a href="user-documentation.html#cb22-45" aria-hidden="true" tabindex="-1"></a><span class="co"># create plot</span></span>
<span id="cb22-46"><a href="user-documentation.html#cb22-46" aria-hidden="true" tabindex="-1"></a>plotly <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">rdf</span>(),</span>
<span id="cb22-47"><a href="user-documentation.html#cb22-47" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">aes</span>(<span class="at">x =</span> median_booking_window,</span>
<span id="cb22-48"><a href="user-documentation.html#cb22-48" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> education_y_lab)) <span class="sc">+</span></span>
<span id="cb22-49"><a href="user-documentation.html#cb22-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">xend =</span> <span class="dv">0</span>, <span class="at">yend =</span> education_y_lab)) <span class="sc">+</span></span>
<span id="cb22-50"><a href="user-documentation.html#cb22-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb22-51"><a href="user-documentation.html#cb22-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb22-52"><a href="user-documentation.html#cb22-52" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> education_y_lab,</span>
<span id="cb22-53"><a href="user-documentation.html#cb22-53" aria-hidden="true" tabindex="-1"></a>      <span class="at">fill =</span> education_y_lab,</span>
<span id="cb22-54"><a href="user-documentation.html#cb22-54" aria-hidden="true" tabindex="-1"></a>      <span class="at">text =</span> <span class="fu">paste0</span>(</span>
<span id="cb22-55"><a href="user-documentation.html#cb22-55" aria-hidden="true" tabindex="-1"></a>        <span class="fu">comma</span>(count, <span class="at">accuracy =</span> <span class="dv">1</span>),</span>
<span id="cb22-56"><a href="user-documentation.html#cb22-56" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot; unique visits were made by people who live in ZIP codes with high &quot;</span>, </span>
<span id="cb22-57"><a href="user-documentation.html#cb22-57" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot; rates of&quot;</span>,</span>
<span id="cb22-58"><a href="user-documentation.html#cb22-58" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&lt;br&gt;&quot;</span>, education, </span>
<span id="cb22-59"><a href="user-documentation.html#cb22-59" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot; as the maximum level of education. &quot;</span>, </span>
<span id="cb22-60"><a href="user-documentation.html#cb22-60" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Typically these visitors reserved their visit between&quot;</span>,</span>
<span id="cb22-61"><a href="user-documentation.html#cb22-61" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;&lt;br&gt;&quot;</span>, <span class="fu">comma</span>(quartile_lower, <span class="at">accuracy =</span> <span class="dv">1</span>), <span class="st">&quot; and &quot;</span>, </span>
<span id="cb22-62"><a href="user-documentation.html#cb22-62" aria-hidden="true" tabindex="-1"></a>        <span class="fu">comma</span>(quartile_upper, <span class="at">accuracy =</span> <span class="dv">1</span>),</span>
<span id="cb22-63"><a href="user-documentation.html#cb22-63" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot; days before the start of their trip, with a median booking window of &quot;</span>, </span>
<span id="cb22-64"><a href="user-documentation.html#cb22-64" aria-hidden="true" tabindex="-1"></a>        <span class="fu">comma</span>(median_booking_window, <span class="at">accuracy =</span> <span class="dv">1</span>),  <span class="st">&quot; days.&quot;</span></span>
<span id="cb22-65"><a href="user-documentation.html#cb22-65" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb22-66"><a href="user-documentation.html#cb22-66" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb22-67"><a href="user-documentation.html#cb22-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">3.5</span>, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">stroke =</span> <span class="dv">2</span> ) <span class="sc">+</span></span>
<span id="cb22-68"><a href="user-documentation.html#cb22-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="fl">0.45</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb22-69"><a href="user-documentation.html#cb22-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> education_group_colors) <span class="sc">+</span></span>
<span id="cb22-70"><a href="user-documentation.html#cb22-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> education_group_colors) <span class="sc">+</span></span>
<span id="cb22-71"><a href="user-documentation.html#cb22-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">paste</span>(<span class="st">&quot;Estimated Number of Days in Advance Site is Reserved&quot;</span>),</span>
<span id="cb22-72"><a href="user-documentation.html#cb22-72" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb22-73"><a href="user-documentation.html#cb22-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb22-74"><a href="user-documentation.html#cb22-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb22-75"><a href="user-documentation.html#cb22-75" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="st">&quot;white&quot;</span>),</span>
<span id="cb22-76"><a href="user-documentation.html#cb22-76" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb22-77"><a href="user-documentation.html#cb22-77" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb22-78"><a href="user-documentation.html#cb22-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-79"><a href="user-documentation.html#cb22-79" aria-hidden="true" tabindex="-1"></a><span class="co"># create plotly</span></span>
<span id="cb22-80"><a href="user-documentation.html#cb22-80" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplotly</span>(plotly,</span>
<span id="cb22-81"><a href="user-documentation.html#cb22-81" aria-hidden="true" tabindex="-1"></a>         <span class="at">tooltip =</span> <span class="fu">list</span>(<span class="st">&quot;text&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb22-82"><a href="user-documentation.html#cb22-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">config</span>(</span>
<span id="cb22-83"><a href="user-documentation.html#cb22-83" aria-hidden="true" tabindex="-1"></a>    <span class="at">modeBarButtonsToRemove =</span> </span>
<span id="cb22-84"><a href="user-documentation.html#cb22-84" aria-hidden="true" tabindex="-1"></a>      <span class="fu">list</span>(<span class="st">&quot;zoom&quot;</span>, <span class="st">&quot;pan&quot;</span>, <span class="st">&quot;select&quot;</span>, <span class="st">&quot;lasso2d&quot;</span>, <span class="st">&quot;autoScale2d&quot;</span>,</span>
<span id="cb22-85"><a href="user-documentation.html#cb22-85" aria-hidden="true" tabindex="-1"></a>           <span class="st">&quot;hoverClosestCartesian&quot;</span>, <span class="st">&quot;hoverCompareCartesian&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb22-86"><a href="user-documentation.html#cb22-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(<span class="at">title =</span> <span class="fu">list</span>(</span>
<span id="cb22-87"><a href="user-documentation.html#cb22-87" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="fu">paste0</span>( <span class="st">&#39;&lt;b&gt;&#39;</span>, siteInput, <span class="st">&#39;&lt;br&gt;&#39;</span>, admin_unitInput, <span class="st">&#39;&lt;/b&gt;&#39;</span>, <span class="st">&#39;&lt;br&gt;&#39;</span>,</span>
<span id="cb22-88"><a href="user-documentation.html#cb22-88" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&#39;Number of Days in Advance Site is Reserved by Visitors with&quot;, </span></span>
<span id="cb22-89"><a href="user-documentation.html#cb22-89" aria-hidden="true" tabindex="-1"></a><span class="st">                   &quot;Different Levels of Education&#39;</span>),</span>
<span id="cb22-90"><a href="user-documentation.html#cb22-90" aria-hidden="true" tabindex="-1"></a>    <span class="at">font =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">15</span>) )) <span class="sc">%&gt;%</span></span>
<span id="cb22-91"><a href="user-documentation.html#cb22-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_annotations</span>(</span>
<span id="cb22-92"><a href="user-documentation.html#cb22-92" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="st">&quot;Reservations from ZIP codes&lt;br&gt;with high proportions of:&quot;</span>,</span>
<span id="cb22-93"><a href="user-documentation.html#cb22-93" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="sc">-</span><span class="fl">0.15</span>, <span class="at">y =</span> <span class="fl">0.9</span>, </span>
<span id="cb22-94"><a href="user-documentation.html#cb22-94" aria-hidden="true" tabindex="-1"></a>    <span class="at">font =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb22-95"><a href="user-documentation.html#cb22-95" aria-hidden="true" tabindex="-1"></a>    <span class="at">xref =</span> <span class="st">&#39;paper&#39;</span>, <span class="at">yref =</span> <span class="st">&#39;paper&#39;</span>, </span>
<span id="cb22-96"><a href="user-documentation.html#cb22-96" aria-hidden="true" tabindex="-1"></a>    <span class="at">showarrow =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
</div>
<div id="spatial-analysis" class="section level4" number="8.3.3.3">
<h4><span class="header-section-number">8.3.3.3</span> Spatial analysis</h4>
<p>We created a state-level visitorshed map to show the number of visitors to overnight reservable sites from each state. We use the package <code>zipcodeR</code> <span class="citation">(<a href="#ref-R-zipcodeR" role="doc-biblioref">Rozzi 2021</a>)</span> to determine the state in which each ZIP code, and thus visitor, is located, using the RIDB data. We then create a dataframe with the necessary geometries using the <code>tigris</code> <span class="citation">(<a href="#ref-R-tigris" role="doc-biblioref">Walker 2022</a>)</span> package. And finally we simplify the geometries to lower the load time within the App using the <code>rmapshaper</code> <span class="citation">(<a href="#ref-R-rmapshaper" role="doc-biblioref">Teucher and Russell 2021</a>)</span> package.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="user-documentation.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ZIP codes and respective states</span></span>
<span id="cb23-2"><a href="user-documentation.html#cb23-2" aria-hidden="true" tabindex="-1"></a>fips_list <span class="ot">&lt;-</span> </span>
<span id="cb23-3"><a href="user-documentation.html#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">&quot;01&quot;</span>, <span class="st">&quot;02&quot;</span>, <span class="st">&quot;04&quot;</span>, <span class="st">&quot;05&quot;</span>, <span class="st">&quot;06&quot;</span>, <span class="st">&quot;08&quot;</span>, <span class="st">&quot;09&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;11&quot;</span>, <span class="st">&quot;12&quot;</span>, </span>
<span id="cb23-4"><a href="user-documentation.html#cb23-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;13&quot;</span>, <span class="st">&quot;15&quot;</span>, <span class="st">&quot;16&quot;</span>, <span class="st">&quot;17&quot;</span>, <span class="st">&quot;18&quot;</span>, <span class="st">&quot;19&quot;</span>, <span class="st">&quot;20&quot;</span>, <span class="st">&quot;21&quot;</span>, <span class="st">&quot;22&quot;</span>, <span class="st">&quot;23&quot;</span>, </span>
<span id="cb23-5"><a href="user-documentation.html#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;24&quot;</span>, <span class="st">&quot;25&quot;</span>, <span class="st">&quot;26&quot;</span>, <span class="st">&quot;27&quot;</span>, <span class="st">&quot;28&quot;</span>, <span class="st">&quot;29&quot;</span>, <span class="st">&quot;30&quot;</span>, <span class="st">&quot;31&quot;</span>, <span class="st">&quot;32&quot;</span>, <span class="st">&quot;33&quot;</span>, </span>
<span id="cb23-6"><a href="user-documentation.html#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;34&quot;</span>, <span class="st">&quot;35&quot;</span>, <span class="st">&quot;36&quot;</span>, <span class="st">&quot;37&quot;</span>, <span class="st">&quot;38&quot;</span>, <span class="st">&quot;39&quot;</span>, <span class="st">&quot;40&quot;</span>, <span class="st">&quot;41&quot;</span>, <span class="st">&quot;42&quot;</span>, <span class="st">&quot;44&quot;</span>, </span>
<span id="cb23-7"><a href="user-documentation.html#cb23-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;45&quot;</span>, <span class="st">&quot;46&quot;</span>, <span class="st">&quot;47&quot;</span>, <span class="st">&quot;48&quot;</span>, <span class="st">&quot;49&quot;</span>, <span class="st">&quot;50&quot;</span>, <span class="st">&quot;51&quot;</span>, <span class="st">&quot;53&quot;</span>, <span class="st">&quot;54&quot;</span>, <span class="st">&quot;55&quot;</span>, </span>
<span id="cb23-8"><a href="user-documentation.html#cb23-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;56&quot;</span>, <span class="st">&quot;72&quot;</span>)</span>
<span id="cb23-9"><a href="user-documentation.html#cb23-9" aria-hidden="true" tabindex="-1"></a>state_list <span class="ot">&lt;-</span> </span>
<span id="cb23-10"><a href="user-documentation.html#cb23-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">&quot;AL&quot;</span>, <span class="st">&quot;AK&quot;</span>, <span class="st">&quot;AZ&quot;</span>, <span class="st">&quot;AR&quot;</span>, <span class="st">&quot;CA&quot;</span>, <span class="st">&quot;CO&quot;</span>, <span class="st">&quot;CT&quot;</span>, <span class="st">&quot;DE&quot;</span>, <span class="st">&quot;DC&quot;</span>, <span class="st">&quot;FL&quot;</span>,</span>
<span id="cb23-11"><a href="user-documentation.html#cb23-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;GA&quot;</span>, <span class="st">&quot;HI&quot;</span>, <span class="st">&quot;ID&quot;</span>, <span class="st">&quot;IL&quot;</span>, <span class="st">&quot;IN&quot;</span>, <span class="st">&quot;IA&quot;</span>, <span class="st">&quot;KS&quot;</span>, <span class="st">&quot;KY&quot;</span>, <span class="st">&quot;LA&quot;</span>, <span class="st">&quot;ME&quot;</span>,</span>
<span id="cb23-12"><a href="user-documentation.html#cb23-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;MD&quot;</span>, <span class="st">&quot;MA&quot;</span>, <span class="st">&quot;MI&quot;</span>, <span class="st">&quot;MN&quot;</span>, <span class="st">&quot;MS&quot;</span>, <span class="st">&quot;MO&quot;</span>, <span class="st">&quot;MT&quot;</span>, <span class="st">&quot;NE&quot;</span>, <span class="st">&quot;NV&quot;</span>, <span class="st">&quot;NH&quot;</span>,</span>
<span id="cb23-13"><a href="user-documentation.html#cb23-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;NJ&quot;</span>, <span class="st">&quot;NM&quot;</span>, <span class="st">&quot;NY&quot;</span>, <span class="st">&quot;NC&quot;</span>, <span class="st">&quot;ND&quot;</span>, <span class="st">&quot;OH&quot;</span>, <span class="st">&quot;OK&quot;</span>, <span class="st">&quot;OR&quot;</span>, <span class="st">&quot;PA&quot;</span>, <span class="st">&quot;RI&quot;</span>,</span>
<span id="cb23-14"><a href="user-documentation.html#cb23-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;SC&quot;</span>, <span class="st">&quot;SD&quot;</span>, <span class="st">&quot;TN&quot;</span>, <span class="st">&quot;TX&quot;</span>, <span class="st">&quot;UT&quot;</span>, <span class="st">&quot;VT&quot;</span>, <span class="st">&quot;VA&quot;</span>, <span class="st">&quot;WA&quot;</span>, <span class="st">&quot;WV&quot;</span>, <span class="st">&quot;WI&quot;</span>,</span>
<span id="cb23-15"><a href="user-documentation.html#cb23-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;WY&quot;</span>, <span class="st">&quot;PR&quot;</span>)</span>
<span id="cb23-16"><a href="user-documentation.html#cb23-16" aria-hidden="true" tabindex="-1"></a>states_names_list <span class="ot">&lt;-</span> </span>
<span id="cb23-17"><a href="user-documentation.html#cb23-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">&quot;Alabama&quot;</span>, <span class="st">&quot;Alaska&quot;</span>, <span class="st">&quot;Arizona&quot;</span>, <span class="st">&quot;Arkansas&quot;</span>, <span class="st">&quot;California&quot;</span>, </span>
<span id="cb23-18"><a href="user-documentation.html#cb23-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Colorado&quot;</span>, <span class="st">&quot;Connecticut&quot;</span>, <span class="st">&quot;Delaware&quot;</span>, <span class="st">&quot;District of Columbia&quot;</span>, </span>
<span id="cb23-19"><a href="user-documentation.html#cb23-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Florida&quot;</span>,<span class="st">&quot;Georgia&quot;</span>, <span class="st">&quot;Hawaii&quot;</span>, <span class="st">&quot;Idaho&quot;</span>, <span class="st">&quot;Illinois&quot;</span>, <span class="st">&quot;Indiana&quot;</span>, </span>
<span id="cb23-20"><a href="user-documentation.html#cb23-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Iowa&quot;</span>, <span class="st">&quot;Kansas&quot;</span>, <span class="st">&quot;Kentucky&quot;</span>, <span class="st">&quot;Louisiana&quot;</span>, <span class="st">&quot;Maine&quot;</span>,<span class="st">&quot;Maryland&quot;</span>, </span>
<span id="cb23-21"><a href="user-documentation.html#cb23-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Massachusetts&quot;</span>, <span class="st">&quot;Michigan&quot;</span>, <span class="st">&quot;Minnesota&quot;</span>, <span class="st">&quot;Mississippi&quot;</span>, <span class="st">&quot;Missouri&quot;</span>, </span>
<span id="cb23-22"><a href="user-documentation.html#cb23-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Montana&quot;</span>, <span class="st">&quot;Nebraska&quot;</span>, <span class="st">&quot;Nevada&quot;</span>, <span class="st">&quot;New Hampshire&quot;</span>,<span class="st">&quot;New Jersey&quot;</span>, </span>
<span id="cb23-23"><a href="user-documentation.html#cb23-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;New Mexico&quot;</span>, <span class="st">&quot;New York&quot;</span>, <span class="st">&quot;North Carolina&quot;</span>, <span class="st">&quot;North Dakota&quot;</span>, <span class="st">&quot;Ohio&quot;</span>, </span>
<span id="cb23-24"><a href="user-documentation.html#cb23-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Oklahoma&quot;</span>, <span class="st">&quot;Oregon&quot;</span>, <span class="st">&quot;Pennsylvania&quot;</span>, <span class="st">&quot;Rhode Island&quot;</span>,<span class="st">&quot;South Carolina&quot;</span>, </span>
<span id="cb23-25"><a href="user-documentation.html#cb23-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;South Dakota&quot;</span>, <span class="st">&quot;Tennessee&quot;</span>, <span class="st">&quot;Texas&quot;</span>, <span class="st">&quot;Utah&quot;</span>, <span class="st">&quot;Vermont&quot;</span>, <span class="st">&quot;Virginia&quot;</span>, </span>
<span id="cb23-26"><a href="user-documentation.html#cb23-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Washington&quot;</span>, <span class="st">&quot;West Virginia&quot;</span>, <span class="st">&quot;Wisconsin&quot;</span>,<span class="st">&quot;Wyoming&quot;</span>, <span class="st">&quot;Puerto Rico&quot;</span>)</span>
<span id="cb23-27"><a href="user-documentation.html#cb23-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-28"><a href="user-documentation.html#cb23-28" aria-hidden="true" tabindex="-1"></a><span class="co"># create dataframe of states</span></span>
<span id="cb23-29"><a href="user-documentation.html#cb23-29" aria-hidden="true" tabindex="-1"></a>df_states_fips <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">list</span>(<span class="at">fips =</span> fips_list,</span>
<span id="cb23-30"><a href="user-documentation.html#cb23-30" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">state =</span> state_list,</span>
<span id="cb23-31"><a href="user-documentation.html#cb23-31" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">state_full =</span> states_names_list))</span>
<span id="cb23-32"><a href="user-documentation.html#cb23-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-33"><a href="user-documentation.html#cb23-33" aria-hidden="true" tabindex="-1"></a><span class="co"># loop through state df to get all ZIP codes w/in state</span></span>
<span id="cb23-34"><a href="user-documentation.html#cb23-34" aria-hidden="true" tabindex="-1"></a>df_states_zip_codes <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb23-35"><a href="user-documentation.html#cb23-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-36"><a href="user-documentation.html#cb23-36" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(fips_list)){</span>
<span id="cb23-37"><a href="user-documentation.html#cb23-37" aria-hidden="true" tabindex="-1"></a>  state <span class="ot">&lt;-</span> zipcodeR<span class="sc">::</span><span class="fu">search_fips</span>(<span class="at">state_fips =</span> fips_list[[i]]) <span class="sc">%&gt;%</span> </span>
<span id="cb23-38"><a href="user-documentation.html#cb23-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(zipcode, state)</span>
<span id="cb23-39"><a href="user-documentation.html#cb23-39" aria-hidden="true" tabindex="-1"></a>  df_states_zip_codes <span class="ot">&lt;-</span> <span class="fu">rbind</span>(df_states_zip_codes, state)</span>
<span id="cb23-40"><a href="user-documentation.html#cb23-40" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-41"><a href="user-documentation.html#cb23-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-42"><a href="user-documentation.html#cb23-42" aria-hidden="true" tabindex="-1"></a><span class="co"># add full state name, fips code, etc. to list of all ZIP codes for each state</span></span>
<span id="cb23-43"><a href="user-documentation.html#cb23-43" aria-hidden="true" tabindex="-1"></a>df_states_fips_zip_codes <span class="ot">&lt;-</span> </span>
<span id="cb23-44"><a href="user-documentation.html#cb23-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="at">x =</span> df_states_zip_codes,</span>
<span id="cb23-45"><a href="user-documentation.html#cb23-45" aria-hidden="true" tabindex="-1"></a>            <span class="at">y =</span> df_states_fips,</span>
<span id="cb23-46"><a href="user-documentation.html#cb23-46" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="st">&quot;state&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-47"><a href="user-documentation.html#cb23-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(fips, zipcode) <span class="sc">%&gt;%</span> </span>
<span id="cb23-48"><a href="user-documentation.html#cb23-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">zip_code =</span> zipcode)</span>
<span id="cb23-49"><a href="user-documentation.html#cb23-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-50"><a href="user-documentation.html#cb23-50" aria-hidden="true" tabindex="-1"></a><span class="co"># get state geometries for full US</span></span>
<span id="cb23-51"><a href="user-documentation.html#cb23-51" aria-hidden="true" tabindex="-1"></a>df_state_geometries_us <span class="ot">&lt;-</span> tigris<span class="sc">::</span><span class="fu">states</span>(<span class="at">year =</span> <span class="dv">2018</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-52"><a href="user-documentation.html#cb23-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, STUSPS, NAME, geometry) <span class="sc">%&gt;%</span> </span>
<span id="cb23-53"><a href="user-documentation.html#cb23-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">fips =</span> GEOID,</span>
<span id="cb23-54"><a href="user-documentation.html#cb23-54" aria-hidden="true" tabindex="-1"></a>         <span class="at">state_abbrev =</span> STUSPS,</span>
<span id="cb23-55"><a href="user-documentation.html#cb23-55" aria-hidden="true" tabindex="-1"></a>         <span class="at">state =</span> NAME) <span class="sc">%&gt;%</span> </span>
<span id="cb23-56"><a href="user-documentation.html#cb23-56" aria-hidden="true" tabindex="-1"></a>  rmapshaper<span class="sc">::</span><span class="fu">ms_simplify</span>(<span class="at">keep =</span> <span class="fl">0.005</span>, <span class="at">keep_shapes =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>We then calculate the number of reservations per state for the site (as chosen by the app user) and use <code>tmaps</code> package <span class="citation">(<a href="#ref-R-tmap" role="doc-biblioref">Tennekes 2022</a>)</span> to create an interactive map that colors states based on the total number of reservations for that state.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="user-documentation.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="do">## -- data wrangle -- ##</span></span>
<span id="cb24-2"><a href="user-documentation.html#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co"># reactive data frame for siteInput</span></span>
<span id="cb24-3"><a href="user-documentation.html#cb24-3" aria-hidden="true" tabindex="-1"></a>rdf <span class="ot">&lt;-</span> <span class="fu">reactive</span> ({</span>
<span id="cb24-4"><a href="user-documentation.html#cb24-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-5"><a href="user-documentation.html#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">validate</span>(</span>
<span id="cb24-6"><a href="user-documentation.html#cb24-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">need</span>(siteInput <span class="sc">!=</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb24-7"><a href="user-documentation.html#cb24-7" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;Please select a reservable site to visualize.&quot;</span>)</span>
<span id="cb24-8"><a href="user-documentation.html#cb24-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="co"># EO validate</span></span>
<span id="cb24-9"><a href="user-documentation.html#cb24-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-10"><a href="user-documentation.html#cb24-10" aria-hidden="true" tabindex="-1"></a>  ridb_df <span class="sc">%&gt;%</span> </span>
<span id="cb24-11"><a href="user-documentation.html#cb24-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(park <span class="sc">%in%</span> siteInput) <span class="sc">%&gt;%</span></span>
<span id="cb24-12"><a href="user-documentation.html#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(agency, admin_unit, park, customer_zip_state_full, </span>
<span id="cb24-13"><a href="user-documentation.html#cb24-13" aria-hidden="true" tabindex="-1"></a>           customer_zip_state)</span>
<span id="cb24-14"><a href="user-documentation.html#cb24-14" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb24-15"><a href="user-documentation.html#cb24-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-16"><a href="user-documentation.html#cb24-16" aria-hidden="true" tabindex="-1"></a><span class="co"># value of total reservations for this park</span></span>
<span id="cb24-17"><a href="user-documentation.html#cb24-17" aria-hidden="true" tabindex="-1"></a>total_reservations <span class="ot">&lt;-</span> <span class="fu">nrow</span>(<span class="fu">rdf</span>())</span>
<span id="cb24-18"><a href="user-documentation.html#cb24-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-19"><a href="user-documentation.html#cb24-19" aria-hidden="true" tabindex="-1"></a><span class="co"># number of reservations and % per state</span></span>
<span id="cb24-20"><a href="user-documentation.html#cb24-20" aria-hidden="true" tabindex="-1"></a>map_data <span class="ot">&lt;-</span> <span class="fu">rdf</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb24-21"><a href="user-documentation.html#cb24-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(customer_zip_state_full, customer_zip_state) <span class="sc">%&gt;%</span></span>
<span id="cb24-22"><a href="user-documentation.html#cb24-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">number_reservations =</span> <span class="fu">n</span>(),</span>
<span id="cb24-23"><a href="user-documentation.html#cb24-23" aria-hidden="true" tabindex="-1"></a>            <span class="at">percentage_reservations =</span> </span>
<span id="cb24-24"><a href="user-documentation.html#cb24-24" aria-hidden="true" tabindex="-1"></a>              <span class="fu">percent</span>((number_reservations <span class="sc">/</span> total_reservations), </span>
<span id="cb24-25"><a href="user-documentation.html#cb24-25" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">accuracy =</span> <span class="fl">0.01</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb24-26"><a href="user-documentation.html#cb24-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(customer_zip_state_full))</span>
<span id="cb24-27"><a href="user-documentation.html#cb24-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-28"><a href="user-documentation.html#cb24-28" aria-hidden="true" tabindex="-1"></a><span class="co"># add state geometries</span></span>
<span id="cb24-29"><a href="user-documentation.html#cb24-29" aria-hidden="true" tabindex="-1"></a>map_data_geometries <span class="ot">&lt;-</span></span>
<span id="cb24-30"><a href="user-documentation.html#cb24-30" aria-hidden="true" tabindex="-1"></a>  state_geometries_df <span class="sc">%&gt;%</span></span>
<span id="cb24-31"><a href="user-documentation.html#cb24-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="at">y =</span> map_data,</span>
<span id="cb24-32"><a href="user-documentation.html#cb24-32" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;state_abbrev&quot;</span> <span class="ot">=</span> <span class="st">&quot;customer_zip_state&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb24-33"><a href="user-documentation.html#cb24-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(number_reservations), </span>
<span id="cb24-34"><a href="user-documentation.html#cb24-34" aria-hidden="true" tabindex="-1"></a>            <span class="sc">~</span><span class="fu">replace</span>(number_reservations, <span class="fu">is.na</span>(number_reservations), <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb24-35"><a href="user-documentation.html#cb24-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(percentage_reservations), </span>
<span id="cb24-36"><a href="user-documentation.html#cb24-36" aria-hidden="true" tabindex="-1"></a>            <span class="sc">~</span><span class="fu">replace</span>(percentage_reservations, <span class="fu">is.na</span>(percentage_reservations), </span>
<span id="cb24-37"><a href="user-documentation.html#cb24-37" aria-hidden="true" tabindex="-1"></a>                     <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb24-38"><a href="user-documentation.html#cb24-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(customer_zip_state_full, number_reservations, </span>
<span id="cb24-39"><a href="user-documentation.html#cb24-39" aria-hidden="true" tabindex="-1"></a>         percentage_reservations, geometry)</span>
<span id="cb24-40"><a href="user-documentation.html#cb24-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-41"><a href="user-documentation.html#cb24-41" aria-hidden="true" tabindex="-1"></a><span class="do">## -- create map -- ##</span></span>
<span id="cb24-42"><a href="user-documentation.html#cb24-42" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">&quot;view&quot;</span>)</span>
<span id="cb24-43"><a href="user-documentation.html#cb24-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-44"><a href="user-documentation.html#cb24-44" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(map_data_geometries) <span class="sc">+</span></span>
<span id="cb24-45"><a href="user-documentation.html#cb24-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">&quot;grey&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb24-46"><a href="user-documentation.html#cb24-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">&quot;number_reservations&quot;</span>,</span>
<span id="cb24-47"><a href="user-documentation.html#cb24-47" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">&quot;Number of Visits&quot;</span>,</span>
<span id="cb24-48"><a href="user-documentation.html#cb24-48" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="st">&quot;YlGn&quot;</span>,</span>
<span id="cb24-49"><a href="user-documentation.html#cb24-49" aria-hidden="true" tabindex="-1"></a>          <span class="at">n =</span> <span class="dv">10</span>,</span>
<span id="cb24-50"><a href="user-documentation.html#cb24-50" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">&quot;jenks&quot;</span>,</span>
<span id="cb24-51"><a href="user-documentation.html#cb24-51" aria-hidden="true" tabindex="-1"></a>          <span class="at">id =</span> <span class="st">&quot;customer_zip_state_full&quot;</span>,</span>
<span id="cb24-52"><a href="user-documentation.html#cb24-52" aria-hidden="true" tabindex="-1"></a>          <span class="at">popup.vars =</span> <span class="fu">c</span>(<span class="st">&quot;Total Visits&quot;</span> <span class="ot">=</span> <span class="st">&quot;number_reservations&quot;</span>,</span>
<span id="cb24-53"><a href="user-documentation.html#cb24-53" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;Percentage of All Visits&quot;</span> <span class="ot">=</span> <span class="st">&quot;percentage_reservations&quot;</span>)</span>
<span id="cb24-54"><a href="user-documentation.html#cb24-54" aria-hidden="true" tabindex="-1"></a>          ) <span class="sc">+</span></span>
<span id="cb24-55"><a href="user-documentation.html#cb24-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_view</span>(<span class="at">set.view =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">101.834335</span>, <span class="fl">40.022356</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb24-56"><a href="user-documentation.html#cb24-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tmap_options</span>(<span class="at">basemaps =</span> <span class="st">&#39;https://server.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}&#39;</span>)</span></code></pre></div>
<p>A ZIP-code level visitorshed map shows the number of visitors to sites for each ZIP code within California only due to computational load of calculating for all ZIP codes in the United States. We then create a dataframe with the necessary geometries using the <code>tigris</code> <span class="citation">(<a href="#ref-R-tigris" role="doc-biblioref">Walker 2022</a>)</span> package. And finally we simplify the geometries to lower the load time within the App using the <code>rmapshaper</code> <span class="citation">(<a href="#ref-R-rmapshaper" role="doc-biblioref">Teucher and Russell 2021</a>)</span> package.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="user-documentation.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="do">## -- ZIP codes and respective states -- ##</span></span>
<span id="cb25-2"><a href="user-documentation.html#cb25-2" aria-hidden="true" tabindex="-1"></a>fips_list <span class="ot">&lt;-</span> </span>
<span id="cb25-3"><a href="user-documentation.html#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">&quot;01&quot;</span>, <span class="st">&quot;02&quot;</span>, <span class="st">&quot;04&quot;</span>, <span class="st">&quot;05&quot;</span>, <span class="st">&quot;06&quot;</span>, <span class="st">&quot;08&quot;</span>, <span class="st">&quot;09&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;11&quot;</span>, <span class="st">&quot;12&quot;</span>, </span>
<span id="cb25-4"><a href="user-documentation.html#cb25-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;13&quot;</span>, <span class="st">&quot;15&quot;</span>, <span class="st">&quot;16&quot;</span>, <span class="st">&quot;17&quot;</span>, <span class="st">&quot;18&quot;</span>, <span class="st">&quot;19&quot;</span>, <span class="st">&quot;20&quot;</span>, <span class="st">&quot;21&quot;</span>, <span class="st">&quot;22&quot;</span>, <span class="st">&quot;23&quot;</span>, </span>
<span id="cb25-5"><a href="user-documentation.html#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;24&quot;</span>, <span class="st">&quot;25&quot;</span>, <span class="st">&quot;26&quot;</span>, <span class="st">&quot;27&quot;</span>, <span class="st">&quot;28&quot;</span>, <span class="st">&quot;29&quot;</span>, <span class="st">&quot;30&quot;</span>, <span class="st">&quot;31&quot;</span>, <span class="st">&quot;32&quot;</span>, <span class="st">&quot;33&quot;</span>, </span>
<span id="cb25-6"><a href="user-documentation.html#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;34&quot;</span>, <span class="st">&quot;35&quot;</span>, <span class="st">&quot;36&quot;</span>, <span class="st">&quot;37&quot;</span>, <span class="st">&quot;38&quot;</span>, <span class="st">&quot;39&quot;</span>, <span class="st">&quot;40&quot;</span>, <span class="st">&quot;41&quot;</span>, <span class="st">&quot;42&quot;</span>, <span class="st">&quot;44&quot;</span>, </span>
<span id="cb25-7"><a href="user-documentation.html#cb25-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;45&quot;</span>, <span class="st">&quot;46&quot;</span>, <span class="st">&quot;47&quot;</span>, <span class="st">&quot;48&quot;</span>, <span class="st">&quot;49&quot;</span>, <span class="st">&quot;50&quot;</span>, <span class="st">&quot;51&quot;</span>, <span class="st">&quot;53&quot;</span>, <span class="st">&quot;54&quot;</span>, <span class="st">&quot;55&quot;</span>, </span>
<span id="cb25-8"><a href="user-documentation.html#cb25-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;56&quot;</span>, <span class="st">&quot;72&quot;</span>)</span>
<span id="cb25-9"><a href="user-documentation.html#cb25-9" aria-hidden="true" tabindex="-1"></a>state_list <span class="ot">&lt;-</span> </span>
<span id="cb25-10"><a href="user-documentation.html#cb25-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">&quot;AL&quot;</span>, <span class="st">&quot;AK&quot;</span>, <span class="st">&quot;AZ&quot;</span>, <span class="st">&quot;AR&quot;</span>, <span class="st">&quot;CA&quot;</span>, <span class="st">&quot;CO&quot;</span>, <span class="st">&quot;CT&quot;</span>, <span class="st">&quot;DE&quot;</span>, <span class="st">&quot;DC&quot;</span>, <span class="st">&quot;FL&quot;</span>,</span>
<span id="cb25-11"><a href="user-documentation.html#cb25-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;GA&quot;</span>, <span class="st">&quot;HI&quot;</span>, <span class="st">&quot;ID&quot;</span>, <span class="st">&quot;IL&quot;</span>, <span class="st">&quot;IN&quot;</span>, <span class="st">&quot;IA&quot;</span>, <span class="st">&quot;KS&quot;</span>, <span class="st">&quot;KY&quot;</span>, <span class="st">&quot;LA&quot;</span>, <span class="st">&quot;ME&quot;</span>,</span>
<span id="cb25-12"><a href="user-documentation.html#cb25-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;MD&quot;</span>, <span class="st">&quot;MA&quot;</span>, <span class="st">&quot;MI&quot;</span>, <span class="st">&quot;MN&quot;</span>, <span class="st">&quot;MS&quot;</span>, <span class="st">&quot;MO&quot;</span>, <span class="st">&quot;MT&quot;</span>, <span class="st">&quot;NE&quot;</span>, <span class="st">&quot;NV&quot;</span>, <span class="st">&quot;NH&quot;</span>,</span>
<span id="cb25-13"><a href="user-documentation.html#cb25-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;NJ&quot;</span>, <span class="st">&quot;NM&quot;</span>, <span class="st">&quot;NY&quot;</span>, <span class="st">&quot;NC&quot;</span>, <span class="st">&quot;ND&quot;</span>, <span class="st">&quot;OH&quot;</span>, <span class="st">&quot;OK&quot;</span>, <span class="st">&quot;OR&quot;</span>, <span class="st">&quot;PA&quot;</span>, <span class="st">&quot;RI&quot;</span>,</span>
<span id="cb25-14"><a href="user-documentation.html#cb25-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;SC&quot;</span>, <span class="st">&quot;SD&quot;</span>, <span class="st">&quot;TN&quot;</span>, <span class="st">&quot;TX&quot;</span>, <span class="st">&quot;UT&quot;</span>, <span class="st">&quot;VT&quot;</span>, <span class="st">&quot;VA&quot;</span>, <span class="st">&quot;WA&quot;</span>, <span class="st">&quot;WV&quot;</span>, <span class="st">&quot;WI&quot;</span>,</span>
<span id="cb25-15"><a href="user-documentation.html#cb25-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;WY&quot;</span>, <span class="st">&quot;PR&quot;</span>)</span>
<span id="cb25-16"><a href="user-documentation.html#cb25-16" aria-hidden="true" tabindex="-1"></a>states_names_list <span class="ot">&lt;-</span> </span>
<span id="cb25-17"><a href="user-documentation.html#cb25-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">&quot;Alabama&quot;</span>, <span class="st">&quot;Alaska&quot;</span>, <span class="st">&quot;Arizona&quot;</span>, <span class="st">&quot;Arkansas&quot;</span>, <span class="st">&quot;California&quot;</span>, </span>
<span id="cb25-18"><a href="user-documentation.html#cb25-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Colorado&quot;</span>, <span class="st">&quot;Connecticut&quot;</span>, <span class="st">&quot;Delaware&quot;</span>, <span class="st">&quot;District of Columbia&quot;</span>, </span>
<span id="cb25-19"><a href="user-documentation.html#cb25-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Florida&quot;</span>,<span class="st">&quot;Georgia&quot;</span>, <span class="st">&quot;Hawaii&quot;</span>, <span class="st">&quot;Idaho&quot;</span>, <span class="st">&quot;Illinois&quot;</span>, <span class="st">&quot;Indiana&quot;</span>, </span>
<span id="cb25-20"><a href="user-documentation.html#cb25-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Iowa&quot;</span>, <span class="st">&quot;Kansas&quot;</span>, <span class="st">&quot;Kentucky&quot;</span>, <span class="st">&quot;Louisiana&quot;</span>, <span class="st">&quot;Maine&quot;</span>,<span class="st">&quot;Maryland&quot;</span>, </span>
<span id="cb25-21"><a href="user-documentation.html#cb25-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Massachusetts&quot;</span>, <span class="st">&quot;Michigan&quot;</span>, <span class="st">&quot;Minnesota&quot;</span>, <span class="st">&quot;Mississippi&quot;</span>, <span class="st">&quot;Missouri&quot;</span>, </span>
<span id="cb25-22"><a href="user-documentation.html#cb25-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Montana&quot;</span>, <span class="st">&quot;Nebraska&quot;</span>, <span class="st">&quot;Nevada&quot;</span>, <span class="st">&quot;New Hampshire&quot;</span>,<span class="st">&quot;New Jersey&quot;</span>, </span>
<span id="cb25-23"><a href="user-documentation.html#cb25-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;New Mexico&quot;</span>, <span class="st">&quot;New York&quot;</span>, <span class="st">&quot;North Carolina&quot;</span>, <span class="st">&quot;North Dakota&quot;</span>, <span class="st">&quot;Ohio&quot;</span>, </span>
<span id="cb25-24"><a href="user-documentation.html#cb25-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Oklahoma&quot;</span>, <span class="st">&quot;Oregon&quot;</span>, <span class="st">&quot;Pennsylvania&quot;</span>, <span class="st">&quot;Rhode Island&quot;</span>,<span class="st">&quot;South Carolina&quot;</span>, </span>
<span id="cb25-25"><a href="user-documentation.html#cb25-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;South Dakota&quot;</span>, <span class="st">&quot;Tennessee&quot;</span>, <span class="st">&quot;Texas&quot;</span>, <span class="st">&quot;Utah&quot;</span>, <span class="st">&quot;Vermont&quot;</span>, <span class="st">&quot;Virginia&quot;</span>, </span>
<span id="cb25-26"><a href="user-documentation.html#cb25-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Washington&quot;</span>, <span class="st">&quot;West Virginia&quot;</span>, <span class="st">&quot;Wisconsin&quot;</span>,<span class="st">&quot;Wyoming&quot;</span>, <span class="st">&quot;Puerto Rico&quot;</span>)</span>
<span id="cb25-27"><a href="user-documentation.html#cb25-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-28"><a href="user-documentation.html#cb25-28" aria-hidden="true" tabindex="-1"></a><span class="co"># create dataframe of states</span></span>
<span id="cb25-29"><a href="user-documentation.html#cb25-29" aria-hidden="true" tabindex="-1"></a>df_states_fips <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">list</span>(<span class="at">fips =</span> fips_list,</span>
<span id="cb25-30"><a href="user-documentation.html#cb25-30" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">state =</span> state_list,</span>
<span id="cb25-31"><a href="user-documentation.html#cb25-31" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">state_full =</span> states_names_list))</span>
<span id="cb25-32"><a href="user-documentation.html#cb25-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-33"><a href="user-documentation.html#cb25-33" aria-hidden="true" tabindex="-1"></a><span class="co"># loop through state df to get all ZIP codes w/in state</span></span>
<span id="cb25-34"><a href="user-documentation.html#cb25-34" aria-hidden="true" tabindex="-1"></a>df_states_zip_codes <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb25-35"><a href="user-documentation.html#cb25-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-36"><a href="user-documentation.html#cb25-36" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(fips_list)){</span>
<span id="cb25-37"><a href="user-documentation.html#cb25-37" aria-hidden="true" tabindex="-1"></a>  state <span class="ot">&lt;-</span> zipcodeR<span class="sc">::</span><span class="fu">search_fips</span>(<span class="at">state_fips =</span> fips_list[[i]]) <span class="sc">%&gt;%</span> </span>
<span id="cb25-38"><a href="user-documentation.html#cb25-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(zipcode, state)</span>
<span id="cb25-39"><a href="user-documentation.html#cb25-39" aria-hidden="true" tabindex="-1"></a>  df_states_zip_codes <span class="ot">&lt;-</span> <span class="fu">rbind</span>(df_states_zip_codes, state)</span>
<span id="cb25-40"><a href="user-documentation.html#cb25-40" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-41"><a href="user-documentation.html#cb25-41" aria-hidden="true" tabindex="-1"></a><span class="co"># add full state name, fips code, etc. to list of all ZIP codes for each state</span></span>
<span id="cb25-42"><a href="user-documentation.html#cb25-42" aria-hidden="true" tabindex="-1"></a>df_states_fips_zip_codes <span class="ot">&lt;-</span> </span>
<span id="cb25-43"><a href="user-documentation.html#cb25-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="at">x =</span> df_states_zip_codes,</span>
<span id="cb25-44"><a href="user-documentation.html#cb25-44" aria-hidden="true" tabindex="-1"></a>            <span class="at">y =</span> df_states_fips,</span>
<span id="cb25-45"><a href="user-documentation.html#cb25-45" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="st">&quot;state&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-46"><a href="user-documentation.html#cb25-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">state_abbrev =</span> state,</span>
<span id="cb25-47"><a href="user-documentation.html#cb25-47" aria-hidden="true" tabindex="-1"></a>         <span class="at">zip_code =</span> zipcode) <span class="sc">%&gt;%</span> </span>
<span id="cb25-48"><a href="user-documentation.html#cb25-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(fips, <span class="at">.before =</span> <span class="dv">2</span>)</span>
<span id="cb25-49"><a href="user-documentation.html#cb25-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-50"><a href="user-documentation.html#cb25-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-51"><a href="user-documentation.html#cb25-51" aria-hidden="true" tabindex="-1"></a><span class="do">## -- CA ZIP geometries -- ##</span></span>
<span id="cb25-52"><a href="user-documentation.html#cb25-52" aria-hidden="true" tabindex="-1"></a>df_zip_geometries_ca <span class="ot">&lt;-</span> <span class="fu">get_acs</span>(<span class="at">geography =</span> <span class="st">&quot;zcta&quot;</span>, <span class="at">year =</span> <span class="dv">2018</span>, </span>
<span id="cb25-53"><a href="user-documentation.html#cb25-53" aria-hidden="true" tabindex="-1"></a>                                <span class="at">geometry =</span> <span class="cn">TRUE</span>,</span>
<span id="cb25-54"><a href="user-documentation.html#cb25-54" aria-hidden="true" tabindex="-1"></a>                                <span class="at">state =</span> <span class="st">&quot;California&quot;</span>,</span>
<span id="cb25-55"><a href="user-documentation.html#cb25-55" aria-hidden="true" tabindex="-1"></a>                                <span class="at">summary_var =</span> <span class="st">&quot;B01001_001&quot;</span>,</span>
<span id="cb25-56"><a href="user-documentation.html#cb25-56" aria-hidden="true" tabindex="-1"></a>                                <span class="at">variables =</span> <span class="fu">c</span>(<span class="at">male =</span> <span class="st">&quot;B01001_002&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb25-57"><a href="user-documentation.html#cb25-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(NAME, geometry) <span class="sc">%&gt;%</span></span>
<span id="cb25-58"><a href="user-documentation.html#cb25-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">zip_code =</span> <span class="fu">str_sub</span>(NAME, <span class="at">start =</span> <span class="sc">-</span><span class="dv">5</span>, <span class="at">end =</span> <span class="sc">-</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb25-59"><a href="user-documentation.html#cb25-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(zip_code, geometry) <span class="sc">%&gt;%</span> </span>
<span id="cb25-60"><a href="user-documentation.html#cb25-60" aria-hidden="true" tabindex="-1"></a>  rmapshaper<span class="sc">::</span><span class="fu">ms_simplify</span>(<span class="at">keep =</span> <span class="fl">0.005</span>, <span class="at">keep_shapes =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-61"><a href="user-documentation.html#cb25-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="at">y =</span> df_states_fips_zip_codes,</span>
<span id="cb25-62"><a href="user-documentation.html#cb25-62" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="st">&quot;zip_code&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-63"><a href="user-documentation.html#cb25-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(zip_code, <span class="at">.before =</span> <span class="dv">1</span>)</span></code></pre></div>
<p>We calculate the number of reservations per ZIP code for the site (as chosen by the app user) and use <code>tmaps</code> to create an interactive map that colors ZIP codes based on the total number of reservations for that ZIP code.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="user-documentation.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="do">## -- data wrangle -- ##</span></span>
<span id="cb26-2"><a href="user-documentation.html#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co"># reactive data frame for siteInput</span></span>
<span id="cb26-3"><a href="user-documentation.html#cb26-3" aria-hidden="true" tabindex="-1"></a>rdf <span class="ot">&lt;-</span> <span class="fu">reactive</span> ({</span>
<span id="cb26-4"><a href="user-documentation.html#cb26-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-5"><a href="user-documentation.html#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">validate</span>(</span>
<span id="cb26-6"><a href="user-documentation.html#cb26-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">need</span>(siteInput <span class="sc">!=</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb26-7"><a href="user-documentation.html#cb26-7" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;Please select a reservable site to visualize.&quot;</span>)</span>
<span id="cb26-8"><a href="user-documentation.html#cb26-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="co"># EO validate</span></span>
<span id="cb26-9"><a href="user-documentation.html#cb26-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-10"><a href="user-documentation.html#cb26-10" aria-hidden="true" tabindex="-1"></a>  ridb_df <span class="sc">%&gt;%</span> </span>
<span id="cb26-11"><a href="user-documentation.html#cb26-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(agency, admin_unit, park, customer_zip, facility_latitude, </span>
<span id="cb26-12"><a href="user-documentation.html#cb26-12" aria-hidden="true" tabindex="-1"></a>           facility_longitude) <span class="sc">%&gt;%</span> </span>
<span id="cb26-13"><a href="user-documentation.html#cb26-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(park <span class="sc">%in%</span> siteInput)</span>
<span id="cb26-14"><a href="user-documentation.html#cb26-14" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb26-15"><a href="user-documentation.html#cb26-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-16"><a href="user-documentation.html#cb26-16" aria-hidden="true" tabindex="-1"></a><span class="co"># number of reservations per ZIP code</span></span>
<span id="cb26-17"><a href="user-documentation.html#cb26-17" aria-hidden="true" tabindex="-1"></a>map_data <span class="ot">&lt;-</span> <span class="fu">rdf</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb26-18"><a href="user-documentation.html#cb26-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(customer_zip) <span class="sc">%&gt;%</span></span>
<span id="cb26-19"><a href="user-documentation.html#cb26-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">number_reservations =</span> <span class="fu">n</span>())</span>
<span id="cb26-20"><a href="user-documentation.html#cb26-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-21"><a href="user-documentation.html#cb26-21" aria-hidden="true" tabindex="-1"></a><span class="co"># join with ZIP geometries</span></span>
<span id="cb26-22"><a href="user-documentation.html#cb26-22" aria-hidden="true" tabindex="-1"></a>map_data_geometries <span class="ot">&lt;-</span></span>
<span id="cb26-23"><a href="user-documentation.html#cb26-23" aria-hidden="true" tabindex="-1"></a>  zip_geometries_df <span class="sc">%&gt;%</span> </span>
<span id="cb26-24"><a href="user-documentation.html#cb26-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(map_data,</span>
<span id="cb26-25"><a href="user-documentation.html#cb26-25" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;zip_code&quot;</span> <span class="ot">=</span> <span class="st">&quot;customer_zip&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb26-26"><a href="user-documentation.html#cb26-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(number_reservations), </span>
<span id="cb26-27"><a href="user-documentation.html#cb26-27" aria-hidden="true" tabindex="-1"></a>            <span class="sc">~</span><span class="fu">replace</span>(number_reservations, <span class="fu">is.na</span>(number_reservations), <span class="dv">0</span>))  <span class="sc">%&gt;%</span> </span>
<span id="cb26-28"><a href="user-documentation.html#cb26-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(zip_code, number_reservations, geometry)</span>
<span id="cb26-29"><a href="user-documentation.html#cb26-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-30"><a href="user-documentation.html#cb26-30" aria-hidden="true" tabindex="-1"></a><span class="co"># value of total CA reservations for this park</span></span>
<span id="cb26-31"><a href="user-documentation.html#cb26-31" aria-hidden="true" tabindex="-1"></a>total_reservations <span class="ot">&lt;-</span> <span class="fu">sum</span>(map_data_geometries<span class="sc">$</span>number_reservations)</span>
<span id="cb26-32"><a href="user-documentation.html#cb26-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-33"><a href="user-documentation.html#cb26-33" aria-hidden="true" tabindex="-1"></a><span class="co"># add percentage of all CA reservations for each ZIP</span></span>
<span id="cb26-34"><a href="user-documentation.html#cb26-34" aria-hidden="true" tabindex="-1"></a>map_data_geometries <span class="ot">&lt;-</span> map_data_geometries <span class="sc">%&gt;%</span> </span>
<span id="cb26-35"><a href="user-documentation.html#cb26-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percentage_reservations =</span> </span>
<span id="cb26-36"><a href="user-documentation.html#cb26-36" aria-hidden="true" tabindex="-1"></a>           <span class="fu">percent</span>((number_reservations <span class="sc">/</span> total_reservations), </span>
<span id="cb26-37"><a href="user-documentation.html#cb26-37" aria-hidden="true" tabindex="-1"></a>                   <span class="at">accuracy =</span> <span class="fl">0.01</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb26-38"><a href="user-documentation.html#cb26-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(percentage_reservations), </span>
<span id="cb26-39"><a href="user-documentation.html#cb26-39" aria-hidden="true" tabindex="-1"></a>            <span class="sc">~</span><span class="fu">replace</span>(percentage_reservations, <span class="fu">is.na</span>(percentage_reservations), </span>
<span id="cb26-40"><a href="user-documentation.html#cb26-40" aria-hidden="true" tabindex="-1"></a>                     <span class="dv">0</span>))</span>
<span id="cb26-41"><a href="user-documentation.html#cb26-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-42"><a href="user-documentation.html#cb26-42" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate location of park for point on map</span></span>
<span id="cb26-43"><a href="user-documentation.html#cb26-43" aria-hidden="true" tabindex="-1"></a>park_location_geom <span class="ot">&lt;-</span> <span class="fu">rdf</span>() <span class="sc">%&gt;%</span></span>
<span id="cb26-44"><a href="user-documentation.html#cb26-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(park) <span class="sc">%&gt;%</span></span>
<span id="cb26-45"><a href="user-documentation.html#cb26-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">facility_latitude =</span> <span class="fu">median</span>(facility_latitude),</span>
<span id="cb26-46"><a href="user-documentation.html#cb26-46" aria-hidden="true" tabindex="-1"></a>            <span class="at">facility_longitude =</span> <span class="fu">median</span>(facility_longitude)) <span class="sc">%&gt;%</span></span>
<span id="cb26-47"><a href="user-documentation.html#cb26-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;facility_latitude&quot;</span>, <span class="st">&quot;facility_longitude&quot;</span>),</span>
<span id="cb26-48"><a href="user-documentation.html#cb26-48" aria-hidden="true" tabindex="-1"></a>           <span class="at">crs =</span> <span class="dv">4326</span>) <span class="sc">%&gt;%</span></span>
<span id="cb26-49"><a href="user-documentation.html#cb26-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">4269</span>) <span class="co"># using NAD83 because measured in meters</span></span>
<span id="cb26-50"><a href="user-documentation.html#cb26-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-51"><a href="user-documentation.html#cb26-51" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;The site&#39;s location has been calculated and it is:&quot;</span>, </span>
<span id="cb26-52"><a href="user-documentation.html#cb26-52" aria-hidden="true" tabindex="-1"></a>            park_location_geom<span class="sc">$</span>geometry))</span>
<span id="cb26-53"><a href="user-documentation.html#cb26-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-54"><a href="user-documentation.html#cb26-54" aria-hidden="true" tabindex="-1"></a><span class="do">## -- create map -- ##</span></span>
<span id="cb26-55"><a href="user-documentation.html#cb26-55" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">&quot;view&quot;</span>)</span>
<span id="cb26-56"><a href="user-documentation.html#cb26-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-57"><a href="user-documentation.html#cb26-57" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(map_data_geometries) <span class="sc">+</span></span>
<span id="cb26-58"><a href="user-documentation.html#cb26-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(</span>
<span id="cb26-59"><a href="user-documentation.html#cb26-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">&quot;number_reservations&quot;</span>,</span>
<span id="cb26-60"><a href="user-documentation.html#cb26-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Number of Visits&quot;</span>,</span>
<span id="cb26-61"><a href="user-documentation.html#cb26-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">palette =</span> <span class="st">&quot;PuRd&quot;</span>,</span>
<span id="cb26-62"><a href="user-documentation.html#cb26-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="st">&quot;jenks&quot;</span>,</span>
<span id="cb26-63"><a href="user-documentation.html#cb26-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="dv">10</span>,</span>
<span id="cb26-64"><a href="user-documentation.html#cb26-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">popup.vars =</span> <span class="fu">c</span>(<span class="st">&quot;Total Visits&quot;</span> <span class="ot">=</span> <span class="st">&quot;number_reservations&quot;</span>,</span>
<span id="cb26-65"><a href="user-documentation.html#cb26-65" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;Percentage of All CA Visits&quot;</span> <span class="ot">=</span> <span class="st">&quot;percentage_reservations&quot;</span>)) <span class="sc">+</span></span>
<span id="cb26-66"><a href="user-documentation.html#cb26-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(park_location_geom) <span class="sc">+</span></span>
<span id="cb26-67"><a href="user-documentation.html#cb26-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">&quot;darkgreen&quot;</span>, <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb26-68"><a href="user-documentation.html#cb26-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(park_location_geom) <span class="sc">+</span></span>
<span id="cb26-69"><a href="user-documentation.html#cb26-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_symbols</span>(<span class="at">shape =</span> map_site_icon,</span>
<span id="cb26-70"><a href="user-documentation.html#cb26-70" aria-hidden="true" tabindex="-1"></a>             <span class="at">id =</span> <span class="st">&quot;park&quot;</span>) <span class="sc">+</span></span>
<span id="cb26-71"><a href="user-documentation.html#cb26-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(ca_cities_df) <span class="sc">+</span></span>
<span id="cb26-72"><a href="user-documentation.html#cb26-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="at">col =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb26-73"><a href="user-documentation.html#cb26-73" aria-hidden="true" tabindex="-1"></a>          <span class="at">text =</span> <span class="st">&quot;city&quot;</span>) <span class="sc">+</span></span>
<span id="cb26-74"><a href="user-documentation.html#cb26-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_view</span>(<span class="at">set.view =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">119.559917</span>, <span class="fl">37.061753</span>, <span class="dv">6</span>)) <span class="sc">+</span></span>
<span id="cb26-75"><a href="user-documentation.html#cb26-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tmap_options</span>(<span class="at">basemaps =</span> <span class="st">&#39;https://server.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}&#39;</span>)</span></code></pre></div>
</div>
</div>
<div id="data-updates" class="section level3" number="8.3.4">
<h3><span class="header-section-number">8.3.4</span> Data updates</h3>
<p>The <code>data_wrangle_and_clean.Rmd</code> document is set up to create the joined dataset necessary for the Outdoor Equity App. To access the ACS data we use the <code>tidycensus</code> package <span class="citation">(<a href="#ref-R-tidycensus" role="doc-biblioref">Walker and Herman 2021</a>)</span> to access the necessary data via API, meaning data updates are not necessary outside of the <code>.Rmd</code> document. The RIDB data is accesses via direct download from the <a href="https://ridb.recreation.gov/download">Recreation.gov</a> website. See the <a href="user-documentation.html#how-to-expand-the-outdoor-equity-app">How to Expand the Outdoor Equity App Section</a> on expanding the time periods included in the App.</p>
</div>
<div id="server-hosting" class="section level3" number="8.3.5">
<h3><span class="header-section-number">8.3.5</span> Server Hosting</h3>
<p>The Outdoor Equity App is hosted on server owned by the Bren School at the University of California, Santa Barbara until the end of 2022. At that time the App will be moved to the shiny.io server for the duration of 2023.</p>
</div>
</div>
<div id="how-to-expand-the-outdoor-equity-app" class="section level2" number="8.4">
<h2><span class="header-section-number">8.4</span> How to Expand the Outdoor Equity App</h2>
<p>The Outdoor Equity App currently only includes reservation data from California for 2018 due to server hosting capabilities. Expanding the App to include additional years and states will require a larger server and likely more computing power.</p>
<div id="temporal-expansions" class="section level3" number="8.4.1">
<h3><span class="header-section-number">8.4.1</span> Temporal Expansions</h3>
<p>To expand the years of data included in the Outdoor Equity App, users must first update the <code>data_wrangle_and_clean.Rmd</code> where all data cleaning and wrangling occurs outside of the shiny app code.</p>
<p>For RIDB data from 2018 and early, users can simply include new code chunks in the <code>.Rmd</code> document that use the following functions to create a joined dataset for each new year: <code>function_ridb_subset-pre2018.R</code>, <code>function_ridb_variable_calculate-pre2018.R</code>, <code>function_acs_race.R</code>, <code>function_acs_median_income.R</code>, <code>function_acs_education.R</code>, <code>function_acs_language.R</code>, and <code>function_join_ridb_acs.R</code>.</p>
<p>For RIDB data from 2019 and later, users must update the <code>function_ridb_subset-post2019.R</code> function. We did not continue to update this function once we decided to include only 2018 data in the App. We recommend updating this function to first select only the necessary variables, then rename the variables so that they match the 2018 and earlier naming conventions, and finally copy and paste the remaining code used in the <code>function_ridb_subset-pre2018.R</code> function. Users can then add new code chunks to the <code>.Rmd</code> document that use the following functions to create a joined dataset for each new year: <code>function_ridb_subset-post2019.R</code>, <code>function_ridb_variable_calculate-pre2018.R</code>, <code>function_acs_race.R</code>, <code>function_acs_median_income.R</code>, <code>function_acs_education.R</code>, <code>function_acs_language.R</code>, and <code>function_join_ridb_acs.R</code>.</p>
<p>RIDB data from 2019 and later may have additional variables available, so we also recommend exploring all available variables to decide if adding in additional variables is appropriate. If users decide to add additional variables, edits will have to be made to all custom functions within the <code>data_preparation</code> and <code>outdoor-equity-app</code> directories.</p>
<p><a href="https://ridb.recreation.gov/standards">Data standards for the RIDB data</a> is in the processing of being updated as of June 2022. Users should check to see if this impacts any decisions in adding additional years to the Outdoor Equity App.</p>
</div>
<div id="spatial-expansions" class="section level3" number="8.4.2">
<h3><span class="header-section-number">8.4.2</span> Spatial Expansions</h3>
<p>To expand the states included in the Outdoor Equity App, users must update the <code>data_wrangle_and_clean.Rmd</code> where all data cleaning and wrangling occurs outside of the shiny app code.</p>
<p>The <code>function_ridb_variable_calculate-pre2018.R</code> function has a section manipulates the character strings of the <code>agency</code>, <code>admin_unit</code>, and <code>park</code> variables. This code would likely need to be changed for additional states as the specific irregularities in character strings may differ state to state. We recommend creating a new function for each additional state. See the <a href="user-documentation.html#ridb-data">RIDB Data Section</a> for a more detailed description of this function code. Once a new custom function is created for each state, code chunks can be added to the <code>.Rmd</code> document to clean and wrangle data for additional states.</p>
</div>
<div id="statistical-analysis" class="section level3" number="8.4.3">
<h3><span class="header-section-number">8.4.3</span> Statistical Analysis</h3>
<p>Currently the Outdoor Equity App only visualizes patterns in the data, but does not allow a user to explore why these patterns are occurring. We recommend considering the following additions to expand the statistical analysis abilities of the App:</p>
<ul>
<li>Simple statistical analysis (such as linear regressions, ANOVA, etc.) to accompany all plots</li>
<li>Ability to combine multiple campsites in a single plot or map to explore patterns and trends across geographic areas and years</li>
</ul>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-ACS" class="csl-entry">
Bureau, United States Census. 2022. <span>“American Community Survey 5-Year Data (2009-2020).”</span> website.
</div>
<div id="ref-R-sf" class="csl-entry">
Pebesma, Edzer. 2022. <em>Sf: Simple Features for r</em>. <a href="https://CRAN.R-project.org/package=sf">https://CRAN.R-project.org/package=sf</a>.
</div>
<div id="ref-R-zipcodeR" class="csl-entry">
Rozzi, Gavin. 2021. <em>zipcodeR: Data &amp; Functions for Working with US ZIP Codes</em>. <a href="https://CRAN.R-project.org/package=zipcodeR">https://CRAN.R-project.org/package=zipcodeR</a>.
</div>
<div id="ref-R-plotly" class="csl-entry">
Sievert, Carson, Chris Parmer, Toby Hocking, Scott Chamberlain, Karthik Ram, Marianne Corvellec, and Pedro Despouy. 2021. <em>Plotly: Create Interactive Web Graphics via Plotly.js</em>. <a href="https://CRAN.R-project.org/package=plotly">https://CRAN.R-project.org/package=plotly</a>.
</div>
<div id="ref-R-tmap" class="csl-entry">
Tennekes, Martijn. 2022. <em>Tmap: Thematic Maps</em>. <a href="https://github.com/r-tmap/tmap">https://github.com/r-tmap/tmap</a>.
</div>
<div id="ref-R-rmapshaper" class="csl-entry">
Teucher, Andy, and Kenton Russell. 2021. <em>Rmapshaper: Client for Mapshaper for Geospatial Operations</em>. <a href="https://github.com/ateucher/rmapshaper">https://github.com/ateucher/rmapshaper</a>.
</div>
<div id="ref-R-tigris" class="csl-entry">
Walker, Kyle. 2022. <em>Tigris: Load Census TIGER/Line Shapefiles</em>. <a href="https://github.com/walkerke/tigris">https://github.com/walkerke/tigris</a>.
</div>
<div id="ref-R-tidycensus" class="csl-entry">
Walker, Kyle, and Matt Herman. 2021. <em>Tidycensus: Load US Census Boundary and Attribute Data as Tidyverse and Sf-Ready Data Frames</em>. <a href="https://walker-data.com/tidycensus/">https://walker-data.com/tidycensus/</a>.
</div>
<div id="ref-R-stringr" class="csl-entry">
Wickham, Hadley. 2019. <em>Stringr: Simple, Consistent Wrappers for Common String Operations</em>. <a href="https://CRAN.R-project.org/package=stringr">https://CRAN.R-project.org/package=stringr</a>.
</div>
<div id="ref-R-tidyverse" class="csl-entry">
———. 2021. <em>Tidyverse: Easily Install and Load the Tidyverse</em>. <a href="https://CRAN.R-project.org/package=tidyverse">https://CRAN.R-project.org/package=tidyverse</a>.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="summary-of-testing.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="additional-challenges.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/07-user-documentation.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "lunr",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
